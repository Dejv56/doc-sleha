<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_maintenance_i.xml" version="5.0" xml:id="sec-conf-hawk2-maintenance">

 <title>使用维护模式</title>

    <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:maintainer/>
    <dm:status>编辑</dm:status>
    <dm:deadline/>
    <dm:priority/>
    <dm:translation>yes</dm:translation>
    <dm:languages/>
    <dm:release/>
    <dm:repository/>
   </dm:docmanager>
    </info>
   <para>
   您可能不时地需要对单个群集组件或整个群集执行测试或维护任务 - 更改群集配置、更新单个节点的软件包，或者将群集升级到更高的产品版本。
  </para>
  <para>
   为此，High Availability Extension 提供了数种级别的 <literal>maintenance</literal> 选项：
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec-conf-hawk2-maint-rsc" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec-conf-hawk2-maint-nodes" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec-conf-hawk2-maint-cluster" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <warning>
   <title>数据丢失风险</title>
   <para>当服务在群集控制下运行时，如果您需要执行任何测试或维护任务，请确保遵照以下说明操作：</para>
   <orderedlist>
    <listitem>
     <para>在开始之前，请将单个资源、节点或整个群集设置到维护模式。这有助于避免一些不利的负面影响，例如，资源未按顺序启动、群集节点之间出现 CIB 不同步的风险，或者丢失数据。 </para>
    </listitem>
    <listitem>
     <para>执行维护任务或测试。</para>
    </listitem>
    <listitem>
     <para>完成后，请解除维护模式以开始正常的群集操作。</para>
    </listitem>
   </orderedlist>
  </warning>

  <para>
   有关处于维护模式的资源和群集的行为的细节，请参见<xref linkend="sec-ha-config-basics-maint-mode"/>。
  </para>
 <sect2 xml:id="sec-conf-hawk2-maint-rsc">
  <title>对资源应用维护模式</title>
  <procedure>
   <step>
    <para>登录 Hawk2：</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>状态</guimenu>。</para>
    </step>
    <step>
     <para>
     在<guimenu>资源</guimenu>选项卡上，选择要置于维护模式的资源。
    </para>
   </step>
   <step>
    <para>在<guimenu>操作</guimenu>列中，单击资源旁边的向下箭头图标并选择<guimenu>维护</guimenu>。确认您的选择。
    </para>
    <para><guimenu>状态</guimenu>屏幕便会更新。<guimenu>状态</guimenu>列现在会为资源显示<guimenu>维护模式</guimenu>图标。资源旁边的<guimenu>操作</guimenu>列也会发生变化。</para>
   </step>
   <step>
    <para>完成资源的维护任务。
    </para>
   </step>
   <step>
    <para>要停用资源的维护模式，请转到<guimenu>操作</guimenu>列并单击<guimenu>禁用维护模式</guimenu>。
    </para>
    <para>
     此后，资源将再次由 High Availability Extension 软件管理。
    </para>
   </step>
  </procedure>
  </sect2>

 <sect2 xml:id="sec-conf-hawk2-maint-nodes">
  <title>对节点应用维护模式</title>
   <para>
    有时候需要将单个节点设置为维护模式。
   </para>
  <procedure>
   <step>
    <para>登录 Hawk2：</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>状态</guimenu>并切换到<guimenu>节点</guimenu>选项卡。</para>
    <para>
     在<guimenu>节点</guimenu>选项卡上，<guimenu>维护</guimenu>列会显示节点的状态：红色图标表示该节点处于维护模式。绿色图标表示该节点处于正常模式，并可切换到维护模式。
     </para>
   </step>
   <step>
    <para>要将节点切换到维护模式，请单击资源旁边的相应图标，并确认您的选择。 </para>
      <para>
     这会将以下实例属性添加至节点：<literal>maintenance="true"</literal>。先前在此节点上运行的资源将变为<literal>不受管理</literal>状态。在该节点脱离维护模式之前，系统不会向其分配新的资源。
    </para>
   </step>
   <step>
    <para>完成节点的维护任务。
    </para>
   </step>
   <step>
    <para>要停用维护模式，请单击节点旁边的维护图标，然后确认您的选择。 </para>
   </step>
 </procedure>
 </sect2>
 <sect2 xml:id="sec-conf-hawk2-maint-cluster">
  <title>对群集应用维护模式</title>
  <para>
   要对整个群集设置或取消设置维护模式，请执行以下操作：
  </para>
  <procedure>
   <step>
    <para>登录 Hawk2：</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     在左侧导航栏中，选择<guimenu>群集配置</guimenu>。
    </para>
    </step>
    <step>
    <para>
     在屏幕的<guimenu>群集配置</guimenu>部分，从空下拉框中选择 <guimenu>maintenance-mode</guimenu> 属性，然后单击<guimenu>加号</guimenu>图标添加该属性。
    </para>
   </step>
   <step>
    <para>
     要将群集置于维护模式，请将 <guimenu>maintenance-mode</guimenu> 的值设置为 <literal>Yes</literal> 并应用您的更改。
    </para>
   </step>
   <step>
    <para>完成整个群集的维护任务。
    </para>
   </step>
   <step>
    <para>要停用群集的维护模式，请将 <guimenu>maintenance-mode</guimenu> 的值设置为 <literal>no</literal> 并应用此更改。
    </para>
    <para>
     此后，High Availability Extension 将再次接管群集管理工作。
    </para>
   </step>
  </procedure>
 </sect2>
 </sect1>
