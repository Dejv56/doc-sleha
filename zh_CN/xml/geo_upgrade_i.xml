<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_upgrade_i.xml" version="5.0" xml:id="sec-ha-geo-upgrade">
 <title>升级到最新产品版本</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>编辑</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para> 有关如何升级群集的一般指导，请参见《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP2</phrase></phrase> 管理指南</citetitle>》。可通过 <link xlink:href="http://www.suse.com/documentation/"/> 获得。“<citetitle>升级群集和更新软件包</citetitle>”一章还说明了启动升级过程之前需要做好的准备。 </para>

 <table xml:id="table-ha-geo-upgrade-oview">
  <title>SLE HA 和 SLE HA Geo 支持的升级路径</title>
  <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="25*"/>
   <colspec colnum="2" colname="2" colwidth="22*"/>
   <colspec colnum="3" colname="3" colwidth="53*"/>
   <thead>
    <row>
     <entry>
      <para> 升级前版本和目标版本 </para>
     </entry>
     <entry>
      <para> 升级路径 </para>
     </entry>
     <entry>
      <para> 有关细节请参见 </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para> 从 SLE HA 11 SP3 升级到 SLE HA (Geo) 12 </para>
     </entry>
     <entry>
      <para> 脱机迁移 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基础系统：《<citetitle>SUSE Linux Enterprise Server 12 部署指南</citetitle>》中的“<citetitle>更新和升级 SUSE Linux Enterprise</citetitle>”部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle> 管理指南》的“<citetitle>升级群集和更新软件包</citetitle>”一章中的“<citetitle>脱机迁移</citetitle>”一节
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-offline" xrefstyle="select:title nopage"/>
        </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 从 SLE HA (Geo) 11 SP4 升级到 SLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> 脱机迁移 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基础系统：《<citetitle>SUSE Linux Enterprise Server 12 SP1 部署指南</citetitle>》中的“<citetitle>更新和升级 SUSE Linux Enterprise</citetitle>”部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle> 管理指南》的“<citetitle>升级群集和更新软件包</citetitle>”一章中的“<citetitle>脱机迁移</citetitle>”一节
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 从 SLE HA (Geo) 12 升级到 SLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> 滚动升级 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基础系统：《<citetitle>SUSE Linux Enterprise Server 12 SP1 部署指南</citetitle>》中的“<citetitle>更新和升级 SUSE Linux Enterprise</citetitle>”部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle> 管理指南》的“<citetitle>升级群集和更新软件包</citetitle>”一章中的“<citetitle>滚动升级</citetitle>”一节
        </para>
       </listitem>
       <listitem>
         <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
        </listitem>
       </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 从 SLE HA (Geo) 12 SP1 升级到 SLE HA (Geo) 12 SP2</para>
     </entry>
     <entry>
      <para> 滚动升级 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基础系统：《<citetitle>SUSE Linux Enterprise Server 12 SP2 部署指南</citetitle>》中的“<citetitle>更新和升级 SUSE Linux Enterprise</citetitle>”部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle> 管理指南》的“<citetitle>升级群集和更新软件包</citetitle>”一章中的“<citetitle>滚动升级</citetitle>”一节
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
       <listitem>
        <para>DRBD 8 到 DRBD 9：《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle> 管理指南》的“<citetitle>DRBD</citetitle>”一章中的“<citetitle>从 DRBD 8 迁移到 DRBD 9</citetitle>”）一节
         </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <sect2 xml:id="sec-ha-geo-upgrade-offline">
  <title>脱机迁移</title>
  <para> 本节内容适用于以下方案： </para>
  <itemizedlist>
   <listitem>
    <para> 从 SLE HA Geo 11 SP3 升级到 SLE HA Geo 12</para>
   </listitem>
  </itemizedlist>
  <para> <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 到 11 SP3 中的 booth 版本 (v0.1) 基于 Paxos 算法。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 SP4 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 及 12 SPx 中的 booth 版本 (v0.2) 大体上基于 raft，与运行 v0.1 的系统不兼容。因此，无法从运行旧版 booth 的任何系统滚动升级到运行新版 booth 的系统。必须将所有群集节点脱机，并根据<xref linkend="pro-ha-geo-upgrade-offline"/>中所述迁移整个群集。</para>
  <para> 由于引入了新的多租户功能，新仲裁方 init 脚本无法停止或测试 Paxos v0.1 仲裁方的状态。升级到 v0.2 后，仲裁方将会停止（如果正在运行）。OCF 资源代理 <literal>ocf:pacemaker:booth-site</literal> 能够停止和监视 booth v0.1 站点守护程序。 </para>

  <procedure xml:id="pro-ha-geo-upgrade-offline">
   <title>执行群集范围的脱机迁移</title>
   <step>
    <para>要升级群集节点，请遵循《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle> 管理指南》的“<citetitle>升级群集和更新软件包</citetitle>”一章的“<citetitle>脱机迁移</citetitle>”一节中的指导。 </para>
   </step>
   <step>
    <para> 如果在群集站点外部使用仲裁方： </para>
    <substeps performance="required">
      <step>
      <para> 将每个仲裁方升级到所需的 SUSE Linux Enterprise Server 版本。要了解各个升级过程的细节，请参见<xref linkend="table-ha-geo-upgrade-oview"/>。 </para>
     </step>
     <step>
      <para> 按<xref linkend="sec-ha-geo-inst-arbitrators"/>中所述添加地域群集扩展并安装包。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> 由于 booth 的语法和一致性算法已更改，您需要根据最新要求更新 booth 配置文件。以前，您可以选择性地通过将失效时间和权重追加到票据名称（使用分号 (<literal>;</literal>) 作为分隔符）来指定这些参数。新语法对所有票据选项使用不同的标记。有关细节，请参见<xref linkend="sec-ha-geo-booth"/>。如果指定的失效时间或权重与默认值相同，并且您不想要使用多租户功能，则仍可以使用旧的 <filename>/etc/booth/booth.conf</filename>。 </para>
   </step>
   <step>
    <para> 跨所有群集站点和仲裁方同步更新的 booth 配置文件。 </para>
   </step>
   <step>
    <para> 按<xref linkend="sec-ha-geo-setup-booth-service"/>中所述，在群集站点和仲裁方上启动 booth 服务。 </para>
   </step>
  </procedure>
 </sect2>
 <sect2 xml:id="sec-ha-geo-upgrade-arbitrators">
  <title>仲裁方升级</title>
  <para> 本节内容适用于以下方案： </para>
  <itemizedlist>
   <listitem>
    <para> 从 SLE HA Geo 11 SP4 升级到 SLE HA Geo 12 SP1 </para>
   </listitem>
   <listitem>
    <para> 从 SLE HA Geo 12 升级到 SLE HA Geo 12 SP1</para>
   </listitem>
   <listitem>
    <para> 从 SLE HA Geo 12 SP1 升级到 SLE HA Geo 12 SP2</para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-ha-geo-upgrade-arbitrators">
   <title>升级群集外部的仲裁方</title>
   <para> 如果在群集站点外部使用仲裁方，请针对每个仲裁方执行以下操作：</para>
  <step>
    <para>升级到 SUSE Linux Enterprise Server 的所需目标版本。要了解各个升级过程的细节，请参见<xref linkend="table-ha-geo-upgrade-oview"/>。</para>
   </step>
   <step>
    <para> 按<xref linkend="sec-ha-geo-inst-arbitrators"/>中所述添加地域群集扩展并安装包。 </para>
   </step>
  </procedure>
 </sect2>
</sect1>
