<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_booth_i.xml" version="5.0" xml:id="sec-ha-geo-booth">
 <title>Configuration des services de booth</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>modification</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>oui</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Le fichier de configuration de booth par défaut est <filename>/etc/booth/booth.conf</filename>. Il doit être identique sur tous les sites de votre grappe géographique, y compris les arbitres. Pour garantir une configuration de booth synchrone sur tous les sites et tous les arbitres, utilisez Csync2, comme décrit à la <xref linkend="sec-ha-geo-booth-sync"/>.
 </para>

 <note xml:id="note-ha-geo-booth-ownership">
  <title>propriété du répertoire <filename class="directory">/etc/booth</filename> et de ses fichiers</title>
  <para>
   Le répertoire <filename class="directory">/etc/booth</filename> et tous les fichiers qu'il contient doivent appartenir à l'utilisateur <systemitem class="username">hacluster</systemitem> et au groupe <systemitem class="groupname">haclient</systemitem>. Chaque fois que vous copiez un nouveau fichier à partir de ce répertoire, utilisez l'option <option>-p</option> pour la commande <command>cp</command> afin de conserver la propriété. Lorsque vous créez un nouveau fichier, vous pouvez également définir l'utilisateur et le groupe ultérieurement avec <command>chown</command> <option>hacluster:haclient<replaceable>FILE</replaceable></option>.
  </para>
 </note>

 <para>
   Pour les configurations impliquant plusieurs grappes géographiques, il est possible de <quote>partager</quote> le même arbitre (à partir de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). En fournissant plusieurs fichiers de configuration de booth, vous pouvez démarrer plusieurs instances de booth sur le même arbitre, chaque instance étant exécutée sur un port différent. Vous pouvez ainsi utiliser <emphasis>une</emphasis> machine qui fera office d'arbitre pour <emphasis>différentes</emphasis> grappes géographiques. Pour plus d'informations sur la manière de configurer le booth pour plusieurs grappes géographiques, reportez-vous à la <xref linkend="sec-ha-geo-booth-multi"/>.
 </para>
 
 
 <para>Pour éviter que des parties malveillantes perturbent le service de booth, vous pouvez configurer l'authentification pour la communication avec le booth, sur la base d'une clé partagée. Pour plus de détails, reportez-vous au point <xref linkend="co-ha-geo-booth-config-auth"/> dans l'<xref linkend="ex-ha-booth-conf-default"/>. Tous les hôtes qui communiquent avec plusieurs serveurs de booth ont besoin de cette clé. Veillez donc à inclure le fichier de clé dans la configuration Csync2 ou à le synchroniser manuellement sur toutes les parties.</para>

 <sect2 xml:id="sec-ha-geo-booth-default">
  <title>Configuration de booth par défaut</title>
  <para>
   Pour configurer tous les paramètres nécessaires pour le booth, modifiez manuellement les fichiers de configuration de booth ou utilisez le module <guimenu>Geo Cluster</guimenu> YaST. Pour accéder au module YaST, démarrez-le à partir de la ligne de commande avec <command>yast2 geo-cluster</command> (ou démarrez YaST et sélectionnez <menuchoice> <guimenu>Haute disponibilité</guimenu> <guimenu>Geo Cluster</guimenu> </menuchoice>).
  </para>
  <example xml:id="ex-ha-booth-conf-default">
   <title>Fichier de configuration de booth</title>

<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <co xml:id="co-ha-geo-booth-config-transport"/>
port = 9929 <co xml:id="co-ha-geo-booth-config-port"/>
arbitrator = 147.2.207.14 <co xml:id="co-ha-geo-booth-config-arbitrator"/>
site =  192.168.201.151 <co xml:id="co-ha-geo-booth-config-site"/>
site =  192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey <co xml:id="co-ha-geo-booth-config-auth"/>
ticket = "ticket-nfs" <co xml:id="co-ha-geo-booth-config-ticket"/>
     expire = 600 <co xml:id="co-ha-geo-booth-config-expiry"/>
     timeout = 10 <co xml:id="co-ha-geo-booth-config-timeout"/>
     retries = 5 <co xml:id="co-ha-geo-booth-config-retries"/>
     renewal-freq = 30 <co xml:id="co-ha-geo-booth-config-renewal"/>
     before-acquire-handler<co xml:id="co-ha-geo-booth-config-handler"/> = /etc/booth/ticket-nfs<co xml:id="co-ha-geo-booth-config-script"/> ms_drbd_nfs<co xml:id="co-ha-geo-booth-config-rsc"/>
     acquire-after = 60 <co xml:id="co-ha-geo-booth-config-acquire-after"/>
ticket = "ticketA" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-A<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-1 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
ticket = "ticketB" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-B<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-8 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
    </screen>
   <calloutlist>
    <callout arearefs="co-ha-geo-booth-config-transport">
     <para>
      Protocole de transport utilisé pour la communication entre les sites. Seul le protocole UDP est pris en charge, mais d'autres couches de transport viendront s'ajouter à l'avenir. Actuellement, ce paramètre peut donc être omis.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-port">
     <para>
      Port à utiliser pour la communication entre les instances de booth sur chaque site. Lorsque vous n'utilisez pas le port par défaut (<literal>9929</literal>), choisissez un port qui n'est pas encore utilisé pour les différents services. Veillez à ouvrir le port dans les pare-feu des nœuds et des arbitres. Les clients de booth utilisent le protocole TCP pour communiquer avec le <systemitem class="daemon">boothd</systemitem>. Le booth va toujours relier et écouter tant sur les ports UDP que TCP.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-arbitrator">
     <para>
       Adresse IP de la machine à utiliser comme arbitre. Ajoutez une entrée pour chaque arbitre que vous utilisez dans votre configuration de Geo Cluster.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-site">
     <para>
      Adresse IP utilisée pour le <systemitem class="daemon">boothd</systemitem> sur un site. Ajoutez une entrée pour chaque site que vous utilisez dans votre configuration de Geo Cluster. Veillez à entrer les adresses IP virtuelles correctes (<systemitem>IPaddr2</systemitem>) pour chaque site, sinon le mécanisme de booth ne fonctionnera pas correctement. Pour plus de détails sur la configuration de l'adresse IP virtuelle pour le booth, reportez-vous à la <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. Le booth utilise tant les adresses IPv4 qu'IPv6.

     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-auth">
     <para>
      Paramètre facultatif. Permet l'authentification de booth pour les clients et serveurs en fonction d'une clé partagée. Ce paramètre permet d'indiquer le chemin d'accès au fichier de clé. 
     </para>
     <itemizedlist>
      <title>Exigences concernant la clé</title>
      <listitem>
       <para>La clé peut être de type binaire ou texte.</para>
       <para>Si elle est de type texte, les caractères suivants sont ignorés : espaces blancs de début et de fin, nouvelles lignes.</para>
      </listitem>
      <listitem>
       <para>La longueur de la clé doit être comprise entre 8 et 64 caractères.</para>
      </listitem>
      <listitem>
        <para>La clé doit appartenir à l'utilisateur <systemitem class="username">hacluster</systemitem> et au groupe <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>La clé doit être lisible uniquement par le propriétaire du fichier.</para>
      </listitem>
     </itemizedlist>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-ticket">
     <para>
      Ticket devant être géré par le booth. Pour chaque ticket, ajoutez une entrée <literal>ticket</literal>. Dans cet exemple, le ticket <literal>ticket-nfs</literal> sera utilisé pour le basculement de NFS et DRBD par la suite. Reportez-vous à la <xref linkend="sec-ha-geo-drbd"/> pour plus d'informations. 
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-expiry">
     <para>
      Paramètre facultatif. Définit le délai d'expiration du ticket en secondes. Un site qui s'est vu accorder un ticket va le renouveler régulièrement. Si le booth ne reçoit pas d'informations sur le renouvellement du ticket pendant le délai d'expiration défini, le ticket est révoqué et accordé à un autre site. Si aucune date d'expiration n'est indiquée, le ticket expire par défaut après <literal>600</literal> secondes. Le paramètre ne doit pas être réglé sur une valeur inférieure à 120 secondes.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-timeout">
     <para>
      Paramètre facultatif. Définit une période de timeout en secondes. Passé ce délai, le booth va renvoyer les paquets s'il ne reçoit pas de réponse. Le timeout défini doit être suffisamment long pour permettre aux paquets d'atteindre les autres membres du booth (tous les arbitres et sites).
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-retries">
     <para>
      Paramètre facultatif. Définit combien de fois le booth tente d'envoyer les paquets avant de renoncer en attendant la confirmation d'autres sites. Les valeurs inférieures à <literal>3</literal> ne sont pas valides et empêchent le démarrage du booth.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-renewal">
     <para>
      Paramètre facultatif. Définit la fréquence de renouvellement du ticket. Le ticket est renouvelé à la moitié du délai d'expiration par défaut. Si la fiabilité du réseau est souvent réduite sur des périodes prolongées, il est conseillé de procéder plus souvent au renouvellement. Chaque renouvellement est précédé de l'exécution du paramètre <literal>before-acquire-handler</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-handler">
     <para>
      Paramètre facultatif. Il prend en charge un ou plusieurs scripts. Si vous utilisez plusieurs scripts, chacun d'eux peut être chargé de différents contrôles, comme l'état de la grappe, la connectivité du datacenter, les détecteurs d'état de l'environnement, etc. Enregistrez tous les scripts dans le répertoire <filename>/etc/booth.d/<replaceable>NOM_TICKET</replaceable></filename> et assurez-vous que la propriété soit correcte (utilisateur <systemitem class="username">hacluster</systemitem> et groupe <systemitem class="groupname">haclient</systemitem>). Assignez le nom du répertoire en tant que valeur au paramètre <parameter>before-acquire-handler</parameter>.
     </para>
     <para>
      Les scripts de ce répertoire sont exécutés dans l'ordre alphabétique. Tous les scripts seront appelés avant que <systemitem class="daemon">boothd</systemitem> tente d'acquérir ou de renouveler un ticket. Pour que le ticket puisse être accordé ou renouvelé, <emphasis>tous</emphasis> les scripts doivent réussir. La sémantique est identique à celle d'un script unique : à l'émission d'un code de sortie différent de <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> abandonne le ticket.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-script">
     <para>
      Le script <filename>/usr/share/booth/service-runnable</filename> est inclus dans le produit en tant qu'exemple. Pour l'utiliser, liez-le au répertoire de <quote>ticket</quote> respectif :
     </para>
     <screen><prompt role="root">root # </prompt><command>ln</command> -s /usr/share/booth/service-runnable /etc/booth.d/<replaceable>TICKET_NAME</replaceable></screen>
     <para>
      Supposons que le répertoire <filename>/etc/booth.d<replaceable>NOM_TICKET</replaceable></filename> contient le script <command>service-runnable</command>. Ce script simple est basé sur <command>crm_simulate</command>. Il peut être utilisé pour tester si une ressource de grappe spécifique <emphasis>peut</emphasis> être exécutée sur le site de grappe actuel. En d'autres termes, il vérifie si l'état de santé de la grappe est suffisant pour exécuter la ressource (toutes les dépendances de ressource sont remplies, la partition de grappe a un quorum, aucun noeud n'est altéré, etc.). Par exemple, si un service dans la chaîne de dépendance présente un nombre d'échecs de <literal>INFINITY</literal> sur tous les noeuds disponibles, il ne peut pas être exécuté sur ce site. Dans ce cas, il ne sert à rien de réclamer le ticket.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-rsc">
     <para>
      Ressource devant être testée par le paramètre <literal>before-acquire-handler</literal> (dans ce cas, par le script <filename>service-runnable</filename>). Vous devez référencer la ressource protégée par le ticket respectif. Dans cet exemple, la ressource <literal>db-1</literal> est protégée par <literal>ticketA</literal>, tandis que <literal>db-8</literal> est protégée par <literal>ticketB</literal>. La ressource pour DRBD (<literal>ms_drbd_nfs</literal>) est protégée par le ticket <literal>ticket-nfs</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-acquire-after">
     <para>
      Paramètre facultatif. Après la perte d'un ticket, le booth va attendre pendant ce délai avant d'acquérir le ticket, afin de permettre au site qui a perdu le ticket d'abandonner les ressources, soit en les arrêtant, soit en délimitant un noeud. Un délai standard pourrait être de <literal>60</literal> secondes, mais cela dépend en fin de compte des ressources protégées et de la configuration de la délimitation. La valeur par défaut est <literal>0</literal>.
     </para>
     <para>
      Si vous ignorez combien de temps peut prendre l'arrêt/la rétrogradation des ressources ou la délimitation d'un noeud (en fonction de l'attribut <literal>loss-policy</literal>), utilisez ce paramètre pour éviter l'exécution simultanée de ressources sur deux sites.
     </para>
    </callout>
   </calloutlist>
  </example>
  <procedure xml:id="pro-ha-geo-setup-booth-config-edit">
   <title>Modification manuelle du fichier de configuration de booth</title>
   <step>
    <para>
     Connectez-vous à un noeud de grappe en tant qu'utilisateur <systemitem class="username">root</systemitem> ou équivalent.
    </para>
   </step>
   <step>
    <para>
     Copiez l'exemple de fichier de configuration de booth <filename>/etc/booth/booth.conf.example</filename> dans le fichier <filename>/etc/booth/booth.conf</filename> :
    </para>
    <remark>toms 2016-08-09: "cp -p" is needed, see https://bugzilla.suse.com/show_bug.cgi?id=968865#c14</remark>
    <screen><prompt role="root">root # </prompt><command>cp</command> -p /etc/booth/booth.conf.example /etc/booth/booth.conf</screen>
   </step>
   <step>
    <para>
     Modifiez le fichier <filename>/etc/booth/booth.conf</filename> en suivant l'<xref linkend="ex-ha-booth-conf-default"/>.
    </para>
   </step>
   <step>
    <para>
     Vérifiez vos modifications, puis enregistrez le fichier.
    </para>
   </step>
   <step>
    <para>
     Sur tous les arbitres et noeuds de grappe, ouvrez le port dans le pare-feu que vous avez configuré pour le booth. Reportez-vous à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-port"/>.
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-ha-geo-setup-booth-yast">
   <title>Configuration du booth avec YaST</title>
   <step>
    <para>
     Connectez-vous à un noeud de grappe en tant qu'utilisateur <systemitem class="username">root</systemitem> ou équivalent.
    </para>
   </step>
   <step>
    <para>
     Démarrez le module <guimenu>Geo Cluster</guimenu> YaST.
    </para>
   </step>
   <step>
    <para>
     Choisissez de <guimenu>modifier</guimenu> un fichier de configuration de booth existant ou cliquez sur <guimenu>Ajouter</guimenu> pour créer un nouveau fichier de configuration de booth :
    </para>
    <substeps performance="required">
     <step xml:id="step-ha-booth-conf-params">
      <para>
       Dans l'écran qui s'affiche, configurez les paramètres suivants :
      </para>
      <itemizedlist>
       <listitem>
        <formalpara>
         <title>Fichier de configuration</title>
         <para>
          Nom du fichier de configuration de booth. YaST propose <literal>booth</literal> par défaut. La configuration de booth est donc écrite dans le fichier <filename>/etc/booth/booth.conf</filename>. Ne modifiez cette valeur que si vous devez configurer plusieurs instances de booth pour différentes grappes géographiques comme décrit à la <xref linkend="sec-ha-geo-booth-multi"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Transport</title>
         <para>
          Protocole de transport utilisé pour la communication entre les sites. Seul le protocole UDP est pris en charge, mais d'autres couches de transport viendront s'ajouter à l'avenir. Reportez-vous également à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-transport"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Port</title>
         <para>
          Port à utiliser pour la communication entre les instances de booth sur chaque site. Reportez-vous également à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-port"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Arbitre</title>
         <para>
           Adresse IP de la machine à utiliser comme arbitre. Reportez-vous également à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-arbitrator"/>.
         </para>
        </formalpara>
        <para>
         Pour spécifier un <guimenu>arbitre</guimenu>, cliquez sur <guimenu>Ajouter</guimenu>. Dans la boîte de dialogue qui s'ouvre, entrez l'adresse IP de votre arbitre et cliquez sur <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Site</title>
         <para>
          Adresse IP utilisée pour le <systemitem class="daemon">boothd</systemitem> sur un site. Reportez-vous également à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-site"/>.
         </para>
        </formalpara>
        <para>
         Pour spécifier un <guimenu>site</guimenu> de votre grappe géographique, cliquez sur <guimenu>Ajouter</guimenu>. Dans la boîte de dialogue qui s'ouvre, entrez l'adresse IP d'un site, puis cliquez sur <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Ticket</title>
         <para>
          Ticket devant être géré par le booth. Reportez-vous également à l'<xref linkend="ex-ha-booth-conf-default"/>, point <xref linkend="co-ha-geo-booth-config-ticket"/>.
         </para>
        </formalpara>
        <para>
         Pour spécifier un <guimenu>ticket</guimenu>, cliquez sur <guimenu>Ajouter</guimenu>. Dans la boîte de dialogue qui s'ouvre, entrez un nom de <guimenu>ticket</guimenu> unique. Si vous devez définir plusieurs tickets avec les mêmes paramètres et valeurs, facilitez-vous la tâche en créant un <quote>modèle de ticket</quote> qui spécifie les paramètres et valeurs par défaut pour tous les tickets. Pour ce faire, utilisez<literal>__default__</literal> comme nom du <guimenu>ticket</guimenu>.
        </para>
       </listitem>
       <listitem>
        
        <formalpara>
         <title>Authentification</title>
         <para>Pour activer l'authentification pour le booth, cliquez sur <guimenu>Authentification</guimenu>. Dans la boîte de dialogue qui s'ouvre, sélectionnez <guimenu>Activer l'authentification de sécurité</guimenu>. Si vous disposez déjà d'une clé existante, spécifiez le nom du fichier et le chemin d'accès dans <guimenu>Fichier d'authentification</guimenu>. Pour générer un fichier de clé pour une nouvelle grappe géographique, cliquez sur <guimenu>Générer le fichier de clé d'authentification</guimenu>. La clé sera créée et écrite à l'emplacement spécifié dans <guimenu>Fichier d'authentification</guimenu>.</para>
        </formalpara>
        <para>
         Vous pouvez également spécifier des paramètres facultatifs pour votre ticket. Pour un aperçu, reportez-vous à l'<xref linkend="ex-ha-booth-conf-default"/>, points <xref linkend="co-ha-geo-booth-config-expiry"/> à <xref linkend="co-ha-geo-booth-config-acquire-after"/>.
        </para>
        <para>
         Cliquez sur <guimenu>OK</guimenu> pour confirmer vos modifications.
        </para>
       </listitem>
      </itemizedlist>
      <figure xml:id="fig-yast2-ha-geo-booth">
       <title>Exemple de dépendance de ticket</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="50%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       Cliquez sur <guimenu>OK</guimenu> pour fermer l'écran de configuration de booth actuel. YaST affiche le nom du fichier de configuration de booth que vous avez défini.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Avant de fermer le module YaST, passez à la catégorie <guimenu>Configuration du pare-feu</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Pour ouvrir le port que vous avez configuré pour le booth, sélectionnez <guimenu>Ouvrir port dans pare-feu</guimenu>.
    </para>
    <important>
     <title>paramètre de pare-feu pour la machine locale uniquement</title>
     <para>
      Le paramètre de pare-feu n'est appliqué qu'à la machine actuelle. Il ouvrira les ports UDP/TCP pour tous les ports qui ont été spécifiés dans le fichier <filename>/etc/booth/booth.conf</filename> ou tout autre fichier de configuration de booth (reportez-vous à la <xref linkend="sec-ha-geo-booth-multi"/>).
     </para>
     <para>
      Veillez à ouvrir les ports respectifs sur tous les autres noeuds et arbitres de grappe de votre configuration de Geo Cluster également. Faites-le manuellement ou en synchronisant les fichiers suivants avec Csync2 :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2.d/services/booth</filename>
       </para>
      </listitem>
     </itemizedlist>
    </important>
   </step>
   <step>
    <para>
     Cliquez sur <guimenu>Terminer</guimenu> pour confirmer tous les paramètres et fermer le module YaST. En fonction du <replaceable>NOM</replaceable> du <guimenu>fichier de configuration</guimenu> spécifié à l'<xref linkend="step-ha-booth-conf-params"/>, la configuration est écrite dans le fichier <filename>/etc/booth/<replaceable>NOM</replaceable>.conf</filename>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-multi">
  <title>Configuration de booth pour plusieurs locataires</title>

  <para>
    Pour les configurations impliquant plusieurs grappes géographiques, il est possible de <quote>partager</quote> le même arbitre (à partir de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). En fournissant plusieurs fichiers de configuration de booth, vous pouvez démarrer plusieurs instances de booth sur le même arbitre, chaque instance étant exécutée sur un port différent. Vous pouvez ainsi utiliser <emphasis>une</emphasis> machine qui fera office d'arbitre pour <emphasis>différentes</emphasis> grappes géographiques.
  </para>
  <para>
   Supposons que vous disposiez de deux grappes géographiques, une dans la zone EMEA (Europe, Moyen-Orient et Afrique) et l'autre dans la région Asie-Pacifique (APAC).
  </para>
  <para>
   Pour utiliser le même arbitre pour les deux grappes géographiques, créez deux fichiers de configuration dans le répertoire <filename>/etc/booth</filename> : <filename>/etc/booth/emea.conf</filename>et<filename>/etc/booth/apac.conf</filename>. Les deux fichiers doivent au moins différer au niveau des paramètres suivants :
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Le port utilisé pour la communication des instances de booth.
    </para>
   </listitem>
   <listitem>
    <para>
     Les sites appartenant aux différentes grappes géographiques pour lesquelles l'arbitre est utilisé.
    </para>
   </listitem>
  </itemizedlist>
  <example xml:id="ex-ha-conf-booth-multi-1">
   <title><filename>/etc/booth/apac.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9133 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.2.254 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.1.112 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-apac <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket ="tkt-db-apac-intern" <xref linkend="co-ha-geo-booth-config-ticket"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-apac-intern <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/> 
ticket = "tkt-db-apac-cust" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable db-apac-cust</screen>
  </example>
  <example xml:id="ex-ha-conf-booth-multi-2">
   <title><filename>/etc/booth/emea.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9150 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.201.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-emea <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-crm" <xref linkend="co-ha-geo-booth-config-ticket"/>
     expire = 900 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> sap-crm <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-prod" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable sap-prod</screen>
  </example>
  <calloutlist>
   <callout arearefs="co-ha-geo-booth-config-transport">
    <para>
     Protocole de transport utilisé pour la communication entre les sites. Seul le protocole UDP est pris en charge, mais d'autres couches de transport viendront s'ajouter à l'avenir. Actuellement, ce paramètre peut donc être omis.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-port">
    <para>
     Port à utiliser pour la communication entre les instances de booth sur chaque site. Les fichiers de configuration utilisent différents ports pour permettre le démarrage de plusieurs instances de booth sur le même arbitre.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-arbitrator">
    <para>
      Adresse IP de la machine à utiliser comme arbitre. Dans les exemples ci-dessus, nous utilisons le même arbitre pour différentes grappes géographiques.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-site">
    <para>
     Adresse IP utilisée pour le <systemitem class="daemon">boothd</systemitem> sur un site. Les sites définis dans les deux fichiers de configuration de booth sont différents, car ils appartiennent à deux grappes géographiques différentes.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-auth">
    <para>
     Paramètre facultatif. Permet l'authentification de booth pour les clients et serveurs en fonction d'une clé partagée. Ce paramètre permet d'indiquer le chemin d'accès au fichier de clé. Utilisez différents fichiers de clé pour des locataires différents.
    </para>
    <itemizedlist>
      <title>Exigences concernant la clé</title>
      <listitem>
       <para>La clé peut être de type binaire ou texte.</para>
       <para>Si elle est de type texte, les caractères suivants sont ignorés : espaces blancs de début et de fin, nouvelles lignes.</para>
      </listitem>
      <listitem>
       <para>La longueur de la clé doit être comprise entre 8 et 64 caractères.</para>
      </listitem>
      <listitem>
        <para>La clé doit appartenir à l'utilisateur <systemitem class="username">hacluster</systemitem> et au groupe <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>La clé doit être lisible uniquement par le propriétaire du fichier.</para>
      </listitem>
     </itemizedlist>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-ticket">
    <para>
     Ticket devant être géré par le booth. En théorie, il est possible de définir les mêmes noms de ticket dans différents fichiers de configuration de booth : il n'y aura pas d'interférence entre les tickets puisqu'ils font partie de zones géographiques différentes gérées par des instances de booth différentes. Toutefois, nous vous conseillons (pour une meilleure vue d'ensemble) d'utiliser des noms de ticket distincts pour chaque grappe géographique comme illustré dans les exemples ci-dessus.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-handler">
    <para>
     Paramètre facultatif. S'il est défini, la commande spécifiée sera appelée avant que <systemitem class="daemon">boothd</systemitem> tente d'acquérir ou de renouveler un ticket. À l'émission d'un code de sortie différent de <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> abandonne le ticket.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-script">
    <para>
     Le script <filename>service-runnable</filename> référencé ici est inclus dans le produit en tant qu'exemple. Il s'agit d'un script simple, basé sur <command>crm_simulate</command>. Il peut être utilisé pour tester si une ressource de grappe spécifique <emphasis>peut</emphasis> être exécutée sur le site de grappe actuel. En d'autres termes, il vérifie si l'état de santé de la grappe est suffisant pour exécuter la ressource (toutes les dépendances de ressource sont remplies, la partition de grappe a un quorum, aucun noeud n'est altéré, etc.). Par exemple, si un service dans la chaîne de dépendance présente un nombre d'échecs de <literal>INFINITY</literal> sur tous les noeuds disponibles, il ne peut pas être exécuté sur ce site. Dans ce cas, il ne sert à rien de réclamer le ticket.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-rsc">
    <para>
     Ressource devant être testée par le paramètre <literal>before-acquire-handler</literal> (dans ce cas, par le script <filename>service-runnable</filename>). Vous devez référencer la ressource protégée par le ticket respectif.
    </para>
   </callout>
  </calloutlist>
  <procedure>
   <title>Utilisation du même arbitre pour différentes grappes géographiques</title>
   <step>
    <para>
     Créez différents fichiers de configuration de booth dans le répertoire <filename>/etc/booth</filename> comme illustré dans l'<xref linkend="ex-ha-conf-booth-multi-1"/> et l'<xref linkend="ex-ha-conf-booth-multi-2"/>. Faites-le manuellement ou avec YaST, comme expliqué dans la <xref linkend="pro-ha-geo-setup-booth-yast"/>.
    </para>
   </step>
   <step>
    <para>
     Sur l'arbitre, ouvrez les ports définis dans l'un des fichiers de configuration de booth dans le répertoire <filename>/etc/booth</filename>.
    </para>
   </step>
   <step>
    <para>
     Sur les noeuds appartenant aux différentes grappes géographiques pour lesquelles l'arbitre est utilisé, ouvrez le port utilisé pour l'instance de booth respective.
    </para>
   </step>
   <step>
    <para>
     Synchronisez les fichiers de configuration de booth respectifs sur tous les noeuds et arbitres de grappe qui utilisent la même configuration de booth. Pour plus de détails, reportez-vous à la <xref linkend="sec-ha-geo-booth-sync"/>.
    </para>
   </step>
   <step>
    <para>
     Sur l'arbitre, démarrez les différentes instances de booth comme décrit à la section <xref linkend="vle-ha-geo-setup-booth-service-arbitrator"/> pour des configurations mutualisées.
    </para>
   </step>
   <step>
    <para>
     Sur les différentes grappes géographiques, démarrez le service de booth comme décrit à la section <xref linkend="vle-ha-geo-setup-booth-service-sites"/>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-sync">
  <title>Synchronisation de la configuration de booth sur tous les sites et arbitres</title>
  <note>
   <title>utilisez la même configuration de booth sur tous les sites et arbitres</title>
   <para>
    Pour que le booth fonctionne correctement, tous les noeuds et arbitres au sein d'une grappe géographique doivent utiliser la même configuration de booth.
   </para>
   <para>
    Vous pouvez utiliser Csync2 pour synchroniser la configuration de booth. Pour plus d'informations, reportez-vous à la <xref linkend="sec-ha-geo-booth-sync-csync2-setup"/> et à la <xref linkend="sec-ha-geo-booth-sync-csync2-start"/>.
   </para>
   <para>
    Si vous modifiez une configuration de booth, veillez à mettre à jour les fichiers de configuration en conséquence sur toutes les parties et à redémarrer les services de booth comme décrit à la <xref linkend="sec-ha-geo-setup-booth-reconfig"/>.
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-service">
  <title>Activation et démarrage des services de booth</title>
  <variablelist>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-sites">
    <term>Démarrage des services de booth sur des sites de grappe</term>
    <listitem>
     <para>
      Le service de booth pour chaque site de grappe est géré par le groupe de ressources de booth configuré dans la <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. Pour démarrer une instance du service de booth par site, démarrez le groupe de ressources de booth respectif sur chaque site de grappe.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-arbitrator">
    <term>Démarrage des services de booth sur des arbitres</term>

    <listitem>
     <para>
      À partir de SUSE Linux Enterprise 12, les arbitres de booth sont gérés avec systemd. Le fichier d'unité se nomme <filename>booth@.service</filename>. Le symbole <literal>@</literal> indique la possibilité d'exécuter le service avec un paramètre ; dans ce cas, le nom du fichier de configuration.
     </para>
     <para>
      Pour <emphasis>activer</emphasis> le service de booth sur un arbitre, utilisez la commande suivante :
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable booth@booth</screen>
     <para>
      Une fois le service activé à partir de la ligne de commande, le gestionnaire de services YaST peut alors être utilisé pour gérer le service, aussi longtemps qu'il n'est pas désactivé. Dans ce cas, il disparaîtra de la liste des services dans YaST au prochain redémarrage de systemd.
     </para>
     <para>
      Toutefois, la commande pour <emphasis>démarrer</emphasis> le service de booth dépend de votre configuration de booth :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Si vous utilisez la configuration par défaut comme décrit à la <xref linkend="sec-ha-geo-booth-default"/>, seul le fichier <filename>/etc/booth/booth.conf</filename> est configuré. Dans ce cas, connectez-vous à chaque arbitre et utilisez la commande suivante :
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@booth</screen>
      </listitem>
      <listitem>
       <para>
        Si vous exécutez le booth en mode de mutualisation comme décrit à la <xref linkend="sec-ha-geo-booth-multi"/>, vous avez configuré plusieurs fichiers de configuration de booth dans <filename>/etc/booth</filename>. Pour démarrer les services pour les différentes instances de booth, utilisez <command>systemctl start booth@</command> <replaceable>NOM</replaceable>, où <replaceable>NOM</replaceable> représente le nom du fichier de configuration respectif <filename>/etc/booth/<replaceable>NOM</replaceable>.conf</filename>.
       </para>
       <para>
        Par exemple, si vous disposez des fichiers de configuration de booth <filename>/etc/booth/emea.conf</filename> et <filename>/etc/booth/apac.conf</filename>, connectez-vous à votre arbitre et exécutez les commandes suivantes :
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@emea
<prompt role="root">root # </prompt><command>systemctl</command> start booth@apac</screen>
       <para>

       </para>
      </listitem>
     </itemizedlist>
     <para>
      Le service de booth démarre alors en mode arbitre. Il peut communiquer avec tous les autres daemons de booth, mais contrairement aux daemons de booth exécutés sur les sites de grappe, il ne peut pas se voir accorder un ticket. Les arbitres de booth participent uniquement aux élections. Sinon, ils sont inactifs.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-reconfig">
  <title>Reconfiguration de booth en cours d'exécution</title>

  <para>
   Si vous devez modifier la configuration de booth pendant que les services de booth sont en cours d'exécution, procédez comme suit :
  </para>
  <procedure>
   <step>
    <para>
     Modifiez les fichiers de configuration de booth comme souhaité.
    </para>
   </step>
   <step>
    <para>
     Synchronisez les fichiers de configuration de booth mis à jour sur tous les noeuds et arbitres faisant partie de votre grappe géographique. Pour plus de détails, reportez-vous à la <xref linkend="sec-ha-geo-sync"/>.
    </para>
   </step>
   <step>

    <para>
     Redémarrez les services de booth sur les arbitres et sites de grappe comme décrit à la <xref linkend="sec-ha-geo-setup-booth-service"/>. Cela n'a aucune incidence sur les tickets déjà accordés à des sites.
    </para>
   </step>
  </procedure>
 </sect2>
</sect1>
