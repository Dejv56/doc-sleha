<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_booth_i.xml" version="5.0" xml:id="sec-ha-geo-booth">
 <title>設定 booth 服務</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編輯</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  預設的 booth 組態為 <filename>/etc/booth/booth.conf</filename>。此檔案必須在地理叢集的所有網站 (包括仲裁方) 上相同。若要使 booth 組態在所有網站和仲裁方上保持同步，請依據<xref linkend="sec-ha-geo-booth-sync"/>中所述使用 Csync2。
 </para>

 <note xml:id="note-ha-geo-booth-ownership">
  <title><filename class="directory">/etc/booth</filename> 和檔案的擁有權</title>
  <para>
   目錄 <filename class="directory">/etc/booth</filename> 及其包含的所有檔案需屬於使用者 <systemitem class="username">hacluster</systemitem> 和群組 <systemitem class="groupname">haclient</systemitem>。每當從此目錄複製新檔案時，請使用 <command>cp</command> 指令的 <option>-p</option> 選項來保留擁有權。或者，在建立新檔案時，請隨後使用 <command>chown</command> <option>hacluster:haclient <replaceable>檔案</replaceable></option>設定使用者和群組。
  </para>
 </note>

 <para>
   對於包含多個地理叢集的設定，可以<quote>共享</quote>同一個仲裁方 (從 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 開始)。透過提供多個 booth 組態檔案，可以在同一個仲裁方上啟動多個 booth 例項，其中每個 booth 例項在不同的埠上執行。如此即可以使用<emphasis>一台</emphasis>機器充當<emphasis>不同</emphasis>地理叢集的仲裁方。如需如何為多個地理叢集設定 booth 的詳細資料，請參閱<xref linkend="sec-ha-geo-booth-multi"/>。
 </para>
 
 
 <para>為了防止惡意方中斷 booth 服務，可以依據共用金鑰設定驗證來與 booth 通訊。如需詳細資料，請參閱<xref linkend="ex-ha-booth-conf-default"/>中的<xref linkend="co-ha-geo-booth-config-auth"/>。與不同 booth 伺服器通訊的所有主機都需要此金鑰。因此，請確定在 Csync2 組態中包含金鑰檔案，或者在所有參與方中手動同步此檔案。</para>

 <sect2 xml:id="sec-ha-geo-booth-default">
  <title>預設 Booth 設定</title>
  <para>
   若要設定 booth 所需的全部參數，請手動或者使用 YaST <guimenu>地理叢集</guimenu>模組編輯 booth 組態檔案。若要存取 YaST 模組，請從指令行使用 <command>yast2 geo-cluster</command> 將它啟動 (或者啟動 YaST，然後選取<menuchoice> <guimenu>高可用性</guimenu> <guimenu>地理叢集</guimenu> </menuchoice>)。
  </para>
  <example xml:id="ex-ha-booth-conf-default">
   <title>Booth 組態檔案</title>

<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <co xml:id="co-ha-geo-booth-config-transport"/>
port = 9929 <co xml:id="co-ha-geo-booth-config-port"/>
arbitrator = 147.2.207.14 <co xml:id="co-ha-geo-booth-config-arbitrator"/>
site =  192.168.201.151 <co xml:id="co-ha-geo-booth-config-site"/>
site =  192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey <co xml:id="co-ha-geo-booth-config-auth"/>
ticket = "ticket-nfs" <co xml:id="co-ha-geo-booth-config-ticket"/>
     expire = 600 <co xml:id="co-ha-geo-booth-config-expiry"/>
     timeout = 10 <co xml:id="co-ha-geo-booth-config-timeout"/>
     retries = 5 <co xml:id="co-ha-geo-booth-config-retries"/>
     renewal-freq = 30 <co xml:id="co-ha-geo-booth-config-renewal"/>
     before-acquire-handler<co xml:id="co-ha-geo-booth-config-handler"/> = /etc/booth/ticket-nfs<co xml:id="co-ha-geo-booth-config-script"/> ms_drbd_nfs<co xml:id="co-ha-geo-booth-config-rsc"/>
     acquire-after = 60 <co xml:id="co-ha-geo-booth-config-acquire-after"/>
ticket = "ticketA" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-A<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-1 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
ticket = "ticketB" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-B<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-8 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
    </screen>
   <calloutlist>
    <callout arearefs="co-ha-geo-booth-config-transport">
     <para>
      用於網站間通訊的傳輸通訊協定。僅支援 UDP，但未來可支援其他輸送層。因此，目前可以省略此參數。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-port">
     <para>
      用於在每個網站上 booth 例項之間通訊的埠。如果不使用預設埠 (<literal>9929</literal>)，請選擇尚未用於其他服務的埠。請務必在節點及仲裁方的防火牆中開啟該連接埠。booth 用戶端使用 TCP 來與 <systemitem class="daemon">boothd</systemitem> 通訊。Booth 永遠會同時繫結到 UDP 和 TCP 埠並監聽這些埠。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-arbitrator">
     <para>
       用做仲裁方之機器的 IP 位址。請為地理叢集設定中要使用的每個仲裁方新增一個項目。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-site">
     <para>
      用於網站上 <systemitem class="daemon">boothd</systemitem> 的 IP 位址。請為地理叢集設定中要使用的每個網站新增一個項目。請務必為每個站台輸入正確的虛擬 IP 位址 (<systemitem>IPaddr2</systemitem>)，否則 booth 機制將無法正常運作。如需如何為 booth 設定虛擬 IP 的詳細資料，請參閱<xref linkend="pro-ha-geo-setup-rsc-boothd"/>。Booth 可以使用 IPv4 和 IPv6 位址。

     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-auth">
     <para>
      選擇性的參數。依據共用金鑰為用戶端和伺服器啟用 booth 驗證。此參數指定金鑰檔案的路徑。 
     </para>
     <itemizedlist>
      <title>金鑰要求</title>
      <listitem>
       <para>金鑰可以是二進位值或文字。</para>
       <para>如果是文字，將會忽略以下字元：前置和尾隨空格、換行符。</para>
      </listitem>
      <listitem>
       <para>金鑰長度必須為 8 到 64 個字元。</para>
      </listitem>
      <listitem>
        <para>金鑰必須屬於使用者 <systemitem class="username">hacluster</systemitem> 和群組 <systemitem class="groupname">haclient</systemitem>。
        </para>
      </listitem>
      <listitem>
       <para>金鑰只能由檔案擁有者讀取。</para>
      </listitem>
     </itemizedlist>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-ticket">
     <para>
      booth 要管理的票證。對每個票證新增一個 <literal>ticket</literal> 項目。在本範例中，票證 <literal>ticket-nfs</literal> 在下文中將用於 NFS 和 DRBD 的容錯移轉。如需詳細資料，請參閱<xref linkend="sec-ha-geo-drbd"/>。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-expiry">
     <para>
      選擇性的參數。定義票證的過期時間 (以秒計)。授予了票證的站台將會定期更新票證。如果 booth 在截至所定義的過期時間內未收到任何關於票證更新的資訊，將會撤銷該票證並將其授予其他網站。如果未指定過期時間，票證預設會在 <literal>600</literal> 秒後過期。不應將該參數設定為小於 120 秒的值。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-timeout">
     <para>
      選擇性的參數。定義逾時期限，以秒為單位。如果 booth 未在此期限內收到回覆，則在該段時間過後，booth 會重新傳送封包。定義的逾時應該足夠長，以便封包能夠進入其他 booth 成員 (所有仲裁方和網站)。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-retries">
     <para>
      選擇性的參數。定義 booth 在放棄等待其他網站的確認之前需要重試傳送封包多少次。小於 <literal>3</literal> 的值無效，會阻止 booth 啟動。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-renewal">
     <para>
      選擇性的參數。設定票證更新頻率週期。依預設，票證更新每隔過期時間的一半發生一次。如果在持續較長的一段時間內網路可靠性往往降低，則建議以更高的頻率更新票證。在每次更新之前，應執行 <literal>before-acquire-handler</literal>。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-handler">
     <para>
      選擇性的參數。支援一或多個程序檔。如果使用多個程序檔，則每個程序檔可以負責不同的檢查，例如叢集狀態、資料中心連接狀態、環境狀態感應器和其他檢查。將所有程序檔儲存在目錄 <filename>/etc/booth.d/<replaceable>票證名稱</replaceable></filename>中，並確定它們具有正確的擁有權 (使用者 <systemitem class="username">hacluster</systemitem> 和群組 <systemitem class="groupname">haclient</systemitem>)。將目錄名稱指定為參數值 <parameter>before-acquire-handler</parameter>。
     </para>
     <para>
      此目錄中的程序檔依字母順序執行。在 <systemitem class="daemon">boothd</systemitem> 嘗試取得或更新票證之前，將呼叫所有程序檔。若要授予或更新票證，<emphasis>所有</emphasis>程序檔必須成功。語意與單一程序檔的語意相同：如果退出碼不為 <literal>0</literal>，<systemitem class="daemon">boothd</systemitem> 將放棄票證。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-script">
     <para>
      產品中包含的 <filename>/usr/share/booth/service-runnable</filename> 程序檔用做範例。若要使用該程序檔，請將它連結到相應的 <quote>ticket</quote> 目錄：
     </para>
     <screen><prompt role="root">root # </prompt><command>ln</command> -s /usr/share/booth/service-runnable /etc/booth.d/<replaceable>TICKET_NAME</replaceable></screen>
     <para>
      假設 <filename>/etc/booth.d<replaceable>票證名稱</replaceable></filename>目錄包含 <command>service-runnable</command> 程序檔。這個簡單的程序檔以 <command>crm_simulate</command> 為基礎。它可用於測試是否<emphasis>可以</emphasis>在目前叢集網站上執行特定的叢集資源。這意味著，它會檢查叢集狀態是否足夠良好，可以執行該資源 (滿足所有資源相依性要求、叢集分割區具有仲裁、沒有改動的節點，等等)。例如，如果相依鏈中的某個服務在所有可用節點上的失敗計數為 <literal>INFINITY</literal>，則無法在該網站上執行該服務。在這種情況下，宣告票證就沒有意義。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-rsc">
     <para>
      <literal>before-acquire-handler</literal> (在本例中為 <filename>service-runnable</filename> 程序檔) 要測試的資源。需要參考相應票證保護的資源。在本範例中，資源·<literal>db-1</literal> 由 <literal>ticketA</literal> 保護，<literal>db-8</literal> 由 <literal>ticketB</literal> 保護。DRBD 的資源 (<literal>ms_drbd_nfs</literal>) 由票證 <literal>ticket-nfs</literal> 保護。
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-acquire-after">
     <para>
      選擇性的參數。票證遺失後，booth 將額外等待這段時間，然後再取得票證。這樣一來，遺失票證的網站便可以透過停止資源或者圍籬區隔資源來放棄資源。常用的延遲為 <literal>60</literal> 秒，但最終延遲視受保護的資源和圍籬區隔組態而定。預設值為 <literal>0</literal>。
     </para>
     <para>
      如果您不確定停止資源、降級資源或圍籬區隔節點的時間有多長 (該時間視 <literal>loss-policy</literal> 而定)，可以使用此參數來防止資源同時在兩個網站上執行。
     </para>
    </callout>
   </calloutlist>
  </example>
  <procedure xml:id="pro-ha-geo-setup-booth-config-edit">
   <title>手動編輯 Booth 組態檔案</title>
   <step>
    <para>
     以 <systemitem class="username">root</systemitem> 或同等身分登入叢集節點。
    </para>
   </step>
   <step>
    <para>
     將範例 booth 組態檔案 <filename>/etc/booth/booth.conf.example</filename> 複製到 <filename>/etc/booth/booth.conf</filename>：
    </para>
    <remark>toms 2016-08-09: "cp -p" is needed, see https://bugzilla.suse.com/show_bug.cgi?id=968865#c14</remark>
    <screen><prompt role="root">root # </prompt><command>cp</command> -p /etc/booth/booth.conf.example /etc/booth/booth.conf</screen>
   </step>
   <step>
    <para>
     依據<xref linkend="ex-ha-booth-conf-default"/>編輯 <filename>/etc/booth/booth.conf</filename>。
    </para>
   </step>
   <step>
    <para>
     驗證您的變更並儲存檔案。
    </para>
   </step>
   <step>
    <para>
     在所有叢集節點和仲裁方上，開啓防火牆中為 booth 設定的埠。參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-port"/>。
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-ha-geo-setup-booth-yast">
   <title>使用 YaST 設定 Booth</title>
   <step>
    <para>
     以 <systemitem class="username">root</systemitem> 或同等身分登入叢集節點。
    </para>
   </step>
   <step>
    <para>
     啟動 YaST <guimenu>地理叢集</guimenu>模組。
    </para>
   </step>
   <step>
    <para>
     選擇<guimenu>編輯</guimenu>現有 booth 組態檔案，或者按一下<guimenu>新增</guimenu>建立新的 booth 組態檔案。
    </para>
    <substeps performance="required">
     <step xml:id="step-ha-booth-conf-params">
      <para>
       在出現的螢幕中設定以下參數：
      </para>
      <itemizedlist>
       <listitem>
        <formalpara>
         <title>組態檔案</title>
         <para>
          booth 組態檔案的名稱。YaST 建議依預設使用 <literal>booth</literal>。如此可將 booth 組態寫入 <filename>/etc/booth/booth.conf</filename>。僅當您需要依據<xref linkend="sec-ha-geo-booth-multi"/>中所述為不同的地理叢集設定多個 booth 例項時，才變更此值。
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>輸送</title>
         <para>
          用於網站間通訊的傳輸通訊協定。僅支援 UDP，但未來可支援其他輸送層。另請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-transport"/>。
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>連接埠</title>
         <para>
          用於在每個網站上 booth 例項之間通訊的埠。另請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-port"/>。
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>仲裁方</title>
         <para>
           用做仲裁方之機器的 IP 位址。另請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-arbitrator"/>。
         </para>
        </formalpara>
        <para>
         若要指定<guimenu>仲裁方</guimenu>，請按一下<guimenu>新增</guimenu>。在開啟的對話方塊中，輸入仲裁方的 IP 位址，然後按一下<guimenu>確定</guimenu>。
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>地點</title>
         <para>
          用於網站上 <systemitem class="daemon">boothd</systemitem> 的 IP 位址。另請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-site"/>。
         </para>
        </formalpara>
        <para>
         若要指定地理叢集的<guimenu>網站</guimenu>，請按一下<guimenu>新增</guimenu>。在開啟的對話方塊中，輸入一個網站的 IP 位址，然後按一下<guimenu>確定</guimenu>。
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>票證</title>
         <para>
          booth 要管理的票證。另請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-ticket"/>。
         </para>
        </formalpara>
        <para>
         若要指定<guimenu>票證</guimenu>，請按一下<guimenu>新增</guimenu>。在開啟的對話方塊中，輸入唯一的<guimenu>票證</guimenu>名稱。若要使用相同的參數和值定義多個票證，請建立一個<quote>票證樣板</quote>來為所有票證指定預設參數和值，從而減少組態工作量。為此，請使用 <literal>__default__</literal> 做為<guimenu>票證</guimenu>名稱。
        </para>
       </listitem>
       <listitem>
        
        <formalpara>
         <title>驗證</title>
         <para>若要為 booth 啟用驗證，請按一下<guimenu>驗證</guimenu>，然後在開啟的對話方塊中，啟動<guimenu>啟用安全性驗證</guimenu>。如果已有一個金鑰，請在<guimenu>驗證檔案</guimenu>中指定路徑和檔案名稱。若要為新的地理叢集產生金鑰檔案，請按一下<guimenu>產生驗證金鑰檔案</guimenu>。隨後將會建立金鑰並將其寫入<guimenu>驗證檔案</guimenu>中指定的位置。</para>
        </formalpara>
        <para>
         此外，可以指定票證的選擇性參數。如需綜覽，請參閱<xref linkend="ex-ha-booth-conf-default"/>中的位置 <xref linkend="co-ha-geo-booth-config-expiry"/> 至 <xref linkend="co-ha-geo-booth-config-acquire-after"/>。
        </para>
        <para>
         按一下<guimenu>確定</guimenu>以確認所做的變更。
        </para>
       </listitem>
      </itemizedlist>
      <figure xml:id="fig-yast2-ha-geo-booth">
       <title>範例票證相依性</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="50%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       按一下<guimenu>確定</guimenu>關閉目前的 booth 組態螢幕。YaST 將顯示定義的 booth 組態檔案名稱。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     在關閉 YaST 模組之前，請切換至<guimenu>防火牆組態</guimenu>類別。
    </para>
   </step>
   <step>
    <para>
     若要開啟您為 booth 設定的埠，請啟用<guimenu>在防火牆中開啟埠</guimenu>。
    </para>
    <important>
     <title>防火牆設定僅適用於本地機器</title>
     <para>
      防火牆設定僅適用於目前機器。將為 <filename>/etc/booth/booth.conf</filename> 中指定的所有埠或者其他任何 booth 組態檔案開啟 UDP/TCP 埠 (請參閱<xref linkend="sec-ha-geo-booth-multi"/>)。
     </para>
     <para>
      請確定同時在地理叢集的其他所有節點和仲裁方上開啟相應的埠。可以手動或者將以下檔案與 Csync2 同步來執行此操作：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2.d/services/booth</filename>
       </para>
      </listitem>
     </itemizedlist>
    </important>
   </step>
   <step>
    <para>
     按一下<guimenu>完成</guimenu>確認所有設定並關閉 YaST 模組。視<xref linkend="step-ha-booth-conf-params"/> 中指定的<guimenu>組態檔案</guimenu><replaceable>名稱</replaceable>，組態會寫入 <filename>/etc/booth/<replaceable>名稱</replaceable>.conf</filename>。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-multi">
  <title>多個租用戶的 Booth 設定</title>

  <para>
    對於包含多個地理叢集的設定，可以<quote>共享</quote>同一個仲裁方 (從 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 開始)。透過提供多個 booth 組態檔案，可以在同一個仲裁方上啟動多個 booth 例項，其中每個 booth 例項在不同的埠上執行。如此即可以使用<emphasis>一台</emphasis>機器充當<emphasis>不同</emphasis>地理叢集的仲裁方。
  </para>
  <para>
   假設您有兩個地理叢集，一個位於 EMEA (歐洲、中東和非洲)，另一個位於 APAC (亞太區)。
  </para>
  <para>
   若要為這兩個地理叢集使用相同的仲裁方，請在 <filename>/etc/booth</filename> 目錄中建立兩個組態檔案：<filename>/etc/booth/emea.conf</filename> 和 <filename>/etc/booth/apac.conf</filename>。最起碼，這兩個組態檔案的以下參數必須不同：
  </para>
  <itemizedlist>
   <listitem>
    <para>
     用於 booth 例項通訊的埠。
    </para>
   </listitem>
   <listitem>
    <para>
     屬於使用仲裁方之不同地理叢集的網站。
    </para>
   </listitem>
  </itemizedlist>
  <example xml:id="ex-ha-conf-booth-multi-1">
   <title><filename>/etc/booth/apac.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9133 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.2.254 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.1.112 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-apac <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket ="tkt-db-apac-intern" <xref linkend="co-ha-geo-booth-config-ticket"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-apac-intern <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/> 
ticket = "tkt-db-apac-cust" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable db-apac-cust</screen>
  </example>
  <example xml:id="ex-ha-conf-booth-multi-2">
   <title><filename>/etc/booth/emea.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9150 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.201.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-emea <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-crm" <xref linkend="co-ha-geo-booth-config-ticket"/>
     expire = 900 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> sap-crm <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-prod" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable sap-prod</screen>
  </example>
  <calloutlist>
   <callout arearefs="co-ha-geo-booth-config-transport">
    <para>
     用於網站間通訊的傳輸通訊協定。僅支援 UDP，但未來可支援其他輸送層。因此，目前可以省略此參數。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-port">
    <para>
     用於在每個網站上 booth 例項之間通訊的埠。組態檔案使用不同的埠來允許在相同仲裁方上啟動多個 booth 例項。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-arbitrator">
    <para>
      用做仲裁方之機器的 IP 位址。在上述範例中，我們為不同的地理叢集使用了相同的仲裁方。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-site">
    <para>
     用於網站上 <systemitem class="daemon">boothd</systemitem> 的 IP 位址。兩個 booth 組態檔案中定義的網站不同，因為這些網站屬於兩個不同的地理叢集。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-auth">
    <para>
     選擇性的參數。依據共用金鑰為用戶端和伺服器啟用 booth 驗證。此參數指定金鑰檔案的路徑。為不同的租用戶使用不同的金鑰檔案。
    </para>
    <itemizedlist>
      <title>金鑰要求</title>
      <listitem>
       <para>金鑰可以是二進位值或文字。</para>
       <para>如果是文字，將會忽略以下字元：前置和尾隨空格、換行符。</para>
      </listitem>
      <listitem>
       <para>金鑰長度必須為 8 到 64 個字元。</para>
      </listitem>
      <listitem>
        <para>金鑰必須屬於使用者 <systemitem class="username">hacluster</systemitem> 和群組 <systemitem class="groupname">haclient</systemitem>。
        </para>
      </listitem>
      <listitem>
       <para>金鑰只能由檔案擁有者讀取。</para>
      </listitem>
     </itemizedlist>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-ticket">
    <para>
     booth 要管理的票證。理論上講，可以在不同的 booth 組態檔案中定義相同的票證名稱 — 票證不會造成干擾，因為它們屬於不同 booth 例項管理的不同地理叢集。但是，為了便於綜覽，我們建議依上述範例中所示，為每個地理叢集使用不同的票證名稱。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-handler">
    <para>
     選擇性的參數。如果設定該參數，則在 <systemitem class="daemon">boothd</systemitem> 嘗試取得或更新票證之前，會呼叫指定的指令。如果退出碼不為 <literal>0</literal>，<systemitem class="daemon">boothd</systemitem> 會放棄票證。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-script">
    <para>
     這裡提到的 <filename>service-runnable</filename> 程序檔在產品中用做範例。它是一個以 <command>crm_simulate</command> 為基礎的簡單程序檔。它可用於測試是否<emphasis>可以</emphasis>在目前叢集網站上執行特定的叢集資源。這意味著，它會檢查叢集狀態是否足夠良好，可以執行該資源 (滿足所有資源相依性要求、叢集分割區具有仲裁、沒有改動的節點，等等)。例如，如果相依鏈中的某個服務在所有可用節點上的失敗計數為 <literal>INFINITY</literal>，則無法在該網站上執行該服務。在這種情況下，宣告票證就沒有意義。
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-rsc">
    <para>
     <literal>before-acquire-handler</literal> (在本例中為 <filename>service-runnable</filename> 程序檔) 要測試的資源。需要參考相應票證保護的資源。
    </para>
   </callout>
  </calloutlist>
  <procedure>
   <title>為不同的地理叢集使用相同的仲裁方</title>
   <step>
    <para>
     依<xref linkend="ex-ha-conf-booth-multi-1"/>和<xref linkend="ex-ha-conf-booth-multi-2"/>中所述，在 <filename>/etc/booth</filename> 中建立不同的 booth 組態檔案。可以手動執行此操作，或者依<xref linkend="pro-ha-geo-setup-booth-yast"/>中所述使用 YaST 來建立檔案。
    </para>
   </step>
   <step>
    <para>
     在仲裁方上，開啟 <filename>/etc/booth</filename> 中任一 booth 組態檔案內定義的埠。
    </para>
   </step>
   <step>
    <para>
     在屬於使用仲裁方之個別地理叢集的節點上，開啟相應 booth 例項所用的埠。
    </para>
   </step>
   <step>
    <para>
     在使用相同 booth 組態的所有叢集節點和仲裁方上，同步相應的 booth 組態檔案。如需詳細資料，請參閱<xref linkend="sec-ha-geo-booth-sync"/>。
    </para>
   </step>
   <step>
    <para>
     在仲裁方上，依<xref linkend="vle-ha-geo-setup-booth-service-arbitrator"/>中所述為多租用戶設定啟動個別 booth 例項。
    </para>
   </step>
   <step>
    <para>
     在個別地理叢集上，依<xref linkend="vle-ha-geo-setup-booth-service-sites"/>中所述啟動 booth 服務。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-sync">
  <title>將 Booth 組態同步到所有網站和仲裁方</title>
  <note>
   <title>在所有網站和仲裁方上使用相同的 Booth 組態</title>
   <para>
    若要使 booth 正常運作，一個地理叢集中的所有叢集節點和仲裁方必須使用相同的 booth 組態。
   </para>
   <para>
    可以使用 Csync2 來同步 booth 組態。如需詳細資料，請參閱<xref linkend="sec-ha-geo-booth-sync-csync2-setup"/>與<xref linkend="sec-ha-geo-booth-sync-csync2-start"/>。
   </para>
   <para>
    如果任何 booth 組態發生變更，請務必在所有參與方上相應地更新組態檔案，並依<xref linkend="sec-ha-geo-setup-booth-reconfig"/>中所述重新啟動 booth 服務。
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-service">
  <title>啟用和啟動 Booth 服務</title>
  <variablelist>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-sites">
    <term>在叢集網站上啟動 Booth 服務</term>
    <listitem>
     <para>
      每個叢集網站的 booth 服務由<xref linkend="pro-ha-geo-setup-rsc-boothd"/>中設定的 booth 資源群組管理。若要為每個網站啟動一個 booth 服務例項，請在每個叢集網站上啟動相應的 booth 資源群組。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-arbitrator">
    <term>在仲裁方上啟動 Booth 服務</term>

    <listitem>
     <para>
      從 SUSE Linux Enterprise 12 開始，booth 仲裁方由 systemd 管理。單元檔案名稱為 <filename>booth@.service</filename>。<literal>@</literal> 表示可以使用一個參數 (在本例中為組態檔案的名稱) 執行該服務。
     </para>
     <para>
      若要在仲裁方上<emphasis>啟用</emphasis> booth 服務，請使用以下指令：
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable booth@booth</screen>
     <para>
      從指令行啟用服務後，只要該服務未停用，就可以使用 YaST 服務管理器對它進行管理。如果該服務已停用，則下一次重新啟動 systemd 時，該服務將從 YaST 的服務清單中消失。
     </para>
     <para>
      但是，用於<emphasis>啟動</emphasis> booth 服務的指令視 booth 設定而定：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        如果依<xref linkend="sec-ha-geo-booth-default"/>中所述使用預設設定，則表示只設定了 <filename>/etc/booth/booth.conf</filename>。在這種情況下，請登入每個仲裁方並使用以下指令：
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@booth</screen>
      </listitem>
      <listitem>
       <para>
        如果依<xref linkend="sec-ha-geo-booth-multi"/>中所述以多租用戶模式執行 booth，則已在 <filename>/etc/booth</filename> 中設定多個 booth 組態檔案。若要為個別 booth 例項啟動服務，請使用 <command>systemctl start booth@</command> <replaceable>NAME</replaceable>，其中 <replaceable>NAME</replaceable> 代表相應組態檔案 <filename>/etc/booth/<replaceable>名稱</replaceable>.conf</filename> 的名稱。
       </para>
       <para>
        例如，如果建立了 booth 組態檔案 <filename>/etc/booth/emea.conf</filename> 和 <filename>/etc/booth/apac.conf</filename>，請登入仲裁方並執行以下指令：
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@emea
<prompt role="root">root # </prompt><command>systemctl</command> start booth@apac</screen>
       <para>

       </para>
      </listitem>
     </itemizedlist>
     <para>
      這會在仲裁方模式下啟動 booth 服務。該服務可以與所有其他 booth 精靈通訊，但與在叢集站台上執行的 booth 精靈不同的是，系統無法對它授予票證。Booth 仲裁方只參與選擇。否則，它們處於休眠狀態。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-reconfig">
  <title>執行時重新設定 Booth</title>

  <para>
   如果在已執行 booth 服務的情況下需要變更 booth 組態，請執行以下步驟：
  </para>
  <procedure>
   <step>
    <para>
     視需要調整 booth 組態檔案。
    </para>
   </step>
   <step>
    <para>
     將更新的·booth 組態檔案同步到屬於地理叢集的所有叢集節點和仲裁方。如需詳細資料，請參閱<xref linkend="sec-ha-geo-sync"/>。
    </para>
   </step>
   <step>

    <para>
     依<xref linkend="sec-ha-geo-setup-booth-service"/>中所述，在仲裁方和網站上重新啟動 booth 服務。這不會對授予網站的票證造成任何影響。
    </para>
   </step>
  </procedure>
 </sect2>
</sect1>
