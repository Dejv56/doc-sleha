<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_upgrade_i.xml" version="5.0" xml:id="sec-ha-geo-upgrade">
 <title>升級至最新產品版本</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編輯</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para> 如需如何升級叢集的一般指示，請參閱《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP2</phrase></phrase> 管理指南</citetitle>》。此文件位於 <link xlink:href="http://www.suse.com/documentation/"/>。「<citetitle>升級叢集和更新軟體套件</citetitle>」一章還描述了啟動升級程序之前需要做好的準備。 </para>

 <table xml:id="table-ha-geo-upgrade-oview">
  <title>SLE HA 和 SLE HA Geo 支援的升級路徑</title>
  <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="30*"/>
   <colspec colnum="2" colname="2" colwidth="17*"/>
   <colspec colnum="3" colname="3" colwidth="53*"/>
   <thead>
    <row>
     <entry>
      <para> 升級來源與目標 </para>
     </entry>
     <entry>
      <para> 升級路徑 </para>
     </entry>
     <entry>
      <para> 詳細資料請參閱 </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para> 從 SLE HA 11 SP3 到 SLE HA (Geo) 12 </para>
     </entry>
     <entry>
      <para> 離線移轉 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基礎系統：《<citetitle>SUSE Linux Enterprise Server 12 部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1 管理指南</citetitle>》的「<citetitle>升級叢集和更新軟體套件</citetitle>」一章中的「<citetitle>離線移轉</citetitle>」一節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-offline" xrefstyle="select:title nopage"/>
        </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 從 SLE HA (Geo) 11 SP4 到 SLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> 離線移轉 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基礎系統：《<citetitle>SUSE Linux Enterprise Server 12 SP1 部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1 管理指南</citetitle>》的「<citetitle>升級叢集和更新軟體套件</citetitle>」一章中的「<citetitle>離線移轉</citetitle>」一節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 從 SLE HA (Geo) 12 到 SLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> 滾存升級 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基礎系統：《<citetitle>SUSE Linux Enterprise Server 12 SP1 部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：<citetitle>《<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1 管理指南</citetitle>》的「<citetitle>升級叢集和更新軟體套件</citetitle>」一章中的「<citetitle>滾存升級</citetitle>」一節
        </para>
       </listitem>
       <listitem>
         <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
        </listitem>
       </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> 從 SLE HA (Geo) 12 SP1 到 SLE HA (Geo) 12 SP2</para>
     </entry>
     <entry>
      <para> 滾存升級 </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基礎系統：《<citetitle>SUSE Linux Enterprise Server 12 SP2 部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
        </para>
       </listitem>
       <listitem>
        <para> SLE HA：《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle> 管理指南》的「<citetitle>升級叢集和更新軟體套件</citetitle>」一章中的「<citetitle>滾存升級</citetitle>」一節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo：<xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
       <listitem>
        <para>DRBD 8 至 DRBD 9：《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle> 管理指南》的「<citetitle>DRBD</citetitle>」一章中的「<citetitle>從 DRBD 8 移轉至 DRBD 9</citetitle>」一節
         </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <sect2 xml:id="sec-ha-geo-upgrade-offline">
  <title>離線移轉</title>
  <para> 本節適用於以下案例： </para>
  <itemizedlist>
   <listitem>
    <para> 從 SLE HA Geo 11 SP3 升級至 SLE HA Geo 12</para>
   </listitem>
  </itemizedlist>
  <para> <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 至  11 SP3 中的 booth 版本 (v0.1) 以 Paxos 演算法為基礎。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>  11 SP4 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 及  12 SPx 中的 booth 版本 (v0.2) 大體上以 raft 為基礎，與執行 v0.1 的系統不相容。因此，無法從執行舊版 booth 的任何系統滾存升級至執行新版 booth 的系統。所有叢集節點都必須處於離線狀態，並且需要依照<xref linkend="pro-ha-geo-upgrade-offline"/>所述移轉整個叢集。</para>
  <para> 由於引入了新的多重租用功能，新仲裁方 init 程序檔無法停止或測試 Paxos v0.1 仲裁方的狀態。升級至 v0.2 後，仲裁方將會停止 (如果正在執行中)。OCF 資源代辦 <literal>ocf:pacemaker:booth-site</literal> 可以停止和監控 booth v0.1 網站精靈。 </para>

  <procedure xml:id="pro-ha-geo-upgrade-offline">
   <title>執行全叢集的離線移轉</title>
   <step>
    <para>若要升級叢集節點，請遵循《<citetitle>Administration Guide for <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle> 管理指南》的「<citetitle>升級叢集和更新軟體套件</citetitle>」一章的「<citetitle>離線移轉</citetitle>」一節中的指示。 </para>
   </step>
   <step>
    <para> 如果在叢集網站外部使用仲裁方： </para>
    <substeps performance="required">
      <step>
      <para> 將每個仲裁方升級至所需的 SUSE Linux Enterprise Server 版本。若要瞭解個別升級程序的詳細資料，請參閱<xref linkend="table-ha-geo-upgrade-oview"/>。 </para>
     </step>
     <step>
      <para> 依<xref linkend="sec-ha-geo-inst-arbitrators"/>中所述新增地理叢集延伸並安裝套件。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> 由於 booth 的語法和一致性演算法已變更，您需要根據最新需求更新 booth 組態檔案。以前，您可以選擇性地透過將過期時間和權數附加至票證名稱 (使用分號 (<literal>;</literal>) 做為分隔符) 來指定這些參數。新語法對所有票證選項使用不同的標記。如需詳細資料，請參閱<xref linkend="sec-ha-geo-booth"/>。如果指定的過期時間或權數與預設值相同，並且您不想要使用多重租用功能，則仍可以使用舊版 <filename>/etc/booth/booth.conf</filename>。 </para>
   </step>
   <step>
    <para> 跨所有叢集網站和仲裁方同步更新的 booth 組態檔案。 </para>
   </step>
   <step>
    <para> 依<xref linkend="sec-ha-geo-setup-booth-service"/>中所述，在叢集網站和仲裁方上啟動 booth 服務。 </para>
   </step>
  </procedure>
 </sect2>
 <sect2 xml:id="sec-ha-geo-upgrade-arbitrators">
  <title>仲裁方升級</title>
  <para> 本節適用於以下案例： </para>
  <itemizedlist>
   <listitem>
    <para> 從 SLE HA Geo 11 SP4 升級至 SLE HA Geo 12 SP1 </para>
   </listitem>
   <listitem>
    <para> 從 SLE HA Geo 12 升級至 SLE HA Geo 12 SP1</para>
   </listitem>
   <listitem>
    <para> 從 SLE HA Geo 12 SP1 升級至 SLE HA Geo 12 SP2</para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-ha-geo-upgrade-arbitrators">
   <title>升級叢集外部的仲裁方</title>
   <para> 如果在叢集網站外部使用仲裁方，請針對每個仲裁方執行以下步驟：</para>
  <step>
    <para>升級至 SUSE Linux Enterprise Server 的所需目標版本。若要瞭解個別升級程序的詳細資料，請參閱<xref linkend="table-ha-geo-upgrade-oview"/>。</para>
   </step>
   <step>
    <para> 依<xref linkend="sec-ha-geo-inst-arbitrators"/>中所述新增地理叢集延伸並安裝套件。 </para>
   </step>
  </procedure>
 </sect2>
</sect1>
