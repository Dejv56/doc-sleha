<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec-ha-geo-manage">
 <title>Gerenciando clusters Geo</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editando</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes (sim)</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Para o booth gerenciar determinado ticket no cluster Geo, antes você precisa concedê-lo a um site manualmente.
 </para>

 <sect2 xml:id="sec-ha-geo-manage-cli">
  <title>Da linha de comando</title>
  <para>
   Use a ferramenta de linha de comando <command>booth client</command> para conceder, listar ou revogar tickets, conforme descrito em <xref linkend="vl-ha-booth-client-cmds"/>. Os comandos <command>booth client</command> podem ser executados em qualquer máquina no cluster, não apenas naquelas que executam o <systemitem class="daemon">boothd</systemitem>. Os comandos <command>booth client</command> tentam encontrar o cluster <quote>local</quote> examinando o arquivo de configuração de booth e os endereços IP definidos localmente. Se você não especificar um site ao qual o cliente de booth deverá se conectar (usando a opção <option>-s</option>), ele sempre será conectado ao site local.
  </para>
  <note>
   <title>Mudanças de sintaxe</title>
   <para>
    A sintaxe dos comandos do cliente de booth foi simplificada desde a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11. Por exemplo, a palavra-chave <literal>client</literal> pode ser omitida das operações <option>list</option>, <option>grant</option> ou <option>revoke</option>: <command>booth list</command>. Além disso, a opção <option>-t</option> pode ser omitida ao especificar um ticket.
   </para>
   <para>
    A sintaxe anterior ainda é suportada. Para obter informações detalhadas, consulte a seção <literal>Synopsis</literal> na página de manual do booth. No entanto, os exemplos neste manual usam a sintaxe simplificada.
   </para>
  </note>

  <variablelist xml:id="vl-ha-booth-client-cmds">
   <title>Visão geral dos comandos <command>booth client</command></title>
   <varlistentry>
    <term>Listando todos os tickets</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      Se você não especificar um determinado site com <option>-s</option>, as informações sobre os tickets serão solicitadas da instância de booth local.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Concedendo um ticket a um site</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      Nesse caso, o <literal>ticketA</literal> será concedido ao site <literal>192.168.201.151</literal>. Se você omitir a opção <option>-s</option>, o booth se conectará automaticamente ao site atual (no qual você está executando o cliente de booth) e solicitará a operação <command>grant</command>.
     </para>
     <para>
      Antes de conceder um ticket, o comando executa uma verificação de integridade. Se o mesmo ticket já foi concedido a outro site, você é avisado e solicitado a revogá-lo do site atual primeiro.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Revogando um ticket de um site</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      O booth verifica a qual site o ticket foi concedido e solicita a operação <command>revoke</command> do <literal>ticketA</literal>. A operação de revogação é executada imediatamente.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   As operações <command>grant</command> e, em determinadas circunstâncias, <command>revoke</command> podem levar algum tempo para retornar um resultado definitivo da operação. O cliente aguarda o resultado até o valor de <varname>tempo de espera</varname> do ticket antes de desistir de esperar; a menos que a opção <option>-w</option> tenha sido usada, pois nesse caso o cliente espera indefinidamente. Encontre o status exato nos arquivos de registro ou com o comando <command>crm_ticket -L</command>.
  </para>
  <warning>
   <title><command>crm_ticket</command> e <command>crm site ticket</command></title>
   <para>
    Se o serviço de booth não estiver em execução por qualquer motivo, você também poderá gerenciar os tickets manualmente com os comandos <command>crm_ticket</command> ou <command>crm site ticket</command>. Os dois comandos apenas estão disponíveis nos nós do cluster. Em caso de intervenção, use-os com muito cuidado, pois eles <emphasis>não podem</emphasis> verificar se o mesmo ticket já foi concedido a outro local. Para obter mais informações, leia as páginas de manual.
   </para>
   <para>
    Desde que o booth esteja em execução, apenas use o <command>booth client</command> para intervenção manual.
   </para>
  </warning>
  <para>
   Depois que você conceder primeiro um ticket a um site, o mecanismo de booth assumirá o gerenciamento do ticket automaticamente. Se o site que armazena um ticket tiver que ficar fora de serviço, o ticket será automaticamente revogado após o horário de vencimento e concedido a outro site. Os recursos que dependem desse ticket passam por failover para o novo site que armazena o ticket. Os nós que antes executavam os recursos serão tratados de acordo com a <literal>loss-policy</literal> definida na restrição.
  </para>

  <procedure xml:id="pro-ha-geo-manage-tickets">
   <title>Gerenciando tickets manualmente</title>
   <para>
    Supondo que você queira mover manualmente o <literal>ticket-nfs</literal> do site <literal>amsterdam</literal> (com o IP virtual <literal>192.168.201.151</literal>) para o site <literal>berlin</literal> (com o IP virtual <literal>192.168.202.151</literal>), faça o seguinte:
   </para>
   <step>
    <para>
     Defina o <literal>ticket-nfs</literal> como standby com o seguinte comando:
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     Aguarde até que todos os recursos que dependem do <literal>ticket-nfs</literal> sejam parados ou retrocedidos corretamente.
    </para>
   </step>
   <step>
    <para>
     Revogue o <literal>ticket-nfs</literal> do site <literal>amsterdam</literal> com:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     Depois que o ticket for revogado do seu site original, conceda-o ao site <literal>berlin</literal> com:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
