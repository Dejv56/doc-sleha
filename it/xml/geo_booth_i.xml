<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_booth_i.xml" version="5.0" xml:id="sec-ha-geo-booth">
 <title>Configurazione dei servizi booth</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>modifica</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>sì</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  La configurazione booth di default è <filename>/etc/booth/booth.conf</filename>. Questo file deve essere lo stesso su tutti i siti del Geo cluster, compreso l'arbitro o gli arbitri. Per mantenere sincrona la configurazione booth tra tutti i siti e gli arbitri, utilizzare Csync2, come descritto nella <xref linkend="sec-ha-geo-booth-sync"/>.
 </para>

 <note xml:id="note-ha-geo-booth-ownership">
  <title>proprietà di <filename class="directory">/etc/booth</filename> e file</title>
  <para>
   La directory <filename class="directory">/etc/booth</filename> e tutti i file contenuti devono appartenere all'utente <systemitem class="username">hacluster</systemitem> e al gruppo <systemitem class="groupname">haclient</systemitem>. Qualora da questa directory venga copiato un nuovo file, utilizzare l'opzione <option>-p</option> affinché il comando <command>cp</command> preservi la proprietà. In alternativa, quando si crea un nuovo file, impostare successivamente utente e gruppo con <command>chown</command> <option>hacluster:haclient <replaceable>FILE</replaceable></option>.
  </para>
 </note>

 <para>
   Per configurazioni che comprendono più Geo cluster, è possibile <quote>condividere</quote> lo stesso arbitro (con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Fornendo più file di configurazione booth, è possibile avviare più istanze di booth sullo stesso arbitro, dove ciascuna istanza di booth viene eseguita su una porta diversa. In questo modo, è possibile utilizzare <emphasis>un</emphasis> computer che funga da arbitro per <emphasis>diversi</emphasis> Geo cluster. Per i dettagli su come configurare booth per più Geo cluster, consultare la <xref linkend="sec-ha-geo-booth-multi"/>.
 </para>
 
 
 <para>Per impedire a parti dannose di interrompere il servizio booth, è possibile configurare l'autenticazione per la comunicazione con booth, in base a una chiave condivisa. Per informazioni dettagliate, vedere <xref linkend="co-ha-geo-booth-config-auth"/> nell'<xref linkend="ex-ha-booth-conf-default"/>. Tale chiave è richiesta da tutti gli host che comunicano con vari server booth. Verificare quindi di includere il file della chiave nella configurazione Csync2, oppure di sincronizzarlo manualmente tra tutte le parti.</para>

 <sect2 xml:id="sec-ha-geo-booth-default">
  <title>Configurazione booth di default</title>
  <para>
   Per configurare tutti i parametri necessari per booth, modificare i file di configurazione booth manualmente o mediante il modulo <guimenu>Geo Cluster</guimenu> YaST. Per accedere al modulo YaST, avviarlo dalla riga di comando con <command>yast2 geo-cluster</command> (oppure avviare YaST e selezionare <menuchoice> <guimenu>High Avalability</guimenu> <guimenu>Geo cluster</guimenu> </menuchoice>).
  </para>
  <example xml:id="ex-ha-booth-conf-default">
   <title>Un file di configurazione booth</title>

<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <co xml:id="co-ha-geo-booth-config-transport"/>
port = 9929 <co xml:id="co-ha-geo-booth-config-port"/>
arbitrator = 147.2.207.14 <co xml:id="co-ha-geo-booth-config-arbitrator"/>
site =  192.168.201.151 <co xml:id="co-ha-geo-booth-config-site"/>
site =  192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey <co xml:id="co-ha-geo-booth-config-auth"/>
ticket = "ticket-nfs" <co xml:id="co-ha-geo-booth-config-ticket"/>
     expire = 600 <co xml:id="co-ha-geo-booth-config-expiry"/>
     timeout = 10 <co xml:id="co-ha-geo-booth-config-timeout"/>
     retries = 5 <co xml:id="co-ha-geo-booth-config-retries"/>
     renewal-freq = 30 <co xml:id="co-ha-geo-booth-config-renewal"/>
     before-acquire-handler<co xml:id="co-ha-geo-booth-config-handler"/> = /etc/booth/ticket-nfs<co xml:id="co-ha-geo-booth-config-script"/> ms_drbd_nfs<co xml:id="co-ha-geo-booth-config-rsc"/>
     acquire-after = 60 <co xml:id="co-ha-geo-booth-config-acquire-after"/>
ticket = "ticketA" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-A<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-1 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
ticket = "ticketB" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-B<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-8 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
    </screen>
   <calloutlist>
    <callout arearefs="co-ha-geo-booth-config-transport">
     <para>
      Il protocollo di trasporto utilizzato per la comunicazione tra i siti. È supportato solo UDP, ma in futuro saranno disponibili altri livelli di trasporto. Attualmente, è quindi possibile omettere questo parametro.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-port">
     <para>
      La porta da utilizzare per la comunicazione tra le istanze di booth in ciascun sito. Quando non si utilizza la porta di default (<literal>9929</literal>), scegliere una porta che non sia già utilizzata per servizi diversi. Verificare che la porta sia aperta nei firewall di arbitri e nodi. I client booth utilizzano TCP per comunicare con <systemitem class="daemon">boothd</systemitem>. Booth si associa sempre alle porte UDP e TCP su cui è in ascolto.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-arbitrator">
     <para>
       L'indirizzo IP del computer da utilizzare come arbitro. Aggiungere una voce per ogni arbitro utilizzato nella configurazione del Geo cluster.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-site">
     <para>
      L'indirizzo IP utilizzato per <systemitem class="daemon">boothd</systemitem> su un sito. Aggiungere una voce per ogni sito utilizzato nella configurazione di Geo cluster. Verificare di inserire gli indirizzi IP virtuali corretti (<systemitem>IPaddr2</systemitem>) per ogni sito, in caso contrario il meccanismo di booth non funzionerà correttamente. Per informazioni su come configurare l'IP virtuale per booth, vedere <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. Booth funziona con indirizzi IPv4 e IPv6.

     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-auth">
     <para>
      Parametro opzionale. Consente l'autenticazione booth per client e server in base a una chiave condivisa. Questo parametro specifica il percorso del file della chiave. 
     </para>
     <itemizedlist>
      <title>Requisiti della chiave</title>
      <listitem>
       <para>La chiave può essere binaria o testuale.</para>
       <para>Se testuale, vengono ignorati i seguenti caratteri: spazio iniziale e finale, nuove linee.</para>
      </listitem>
      <listitem>
       <para>La chiave deve contenere tra 8 e 64 caratteri.</para>
      </listitem>
      <listitem>
        <para>La chiave deve appartenere all'utente <systemitem class="username">hacluster</systemitem> e al gruppo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>Solo il proprietario del file deve poter leggere la chiave.</para>
      </listitem>
     </itemizedlist>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-ticket">
     <para>
      La richiesta gestita da booth. Per ciascuna richiesta, aggiungere una voce <literal>richiesta</literal>. In questo esempio, la richiesta <literal>ticket-nfs</literal> verrà utilizzata per il failover di NFS e DRBD di seguito. Per ulteriori informazioni, vedere <xref linkend="sec-ha-geo-drbd"/>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-expiry">
     <para>
      Parametro opzionale. Definisce il tempo di scadenza della richiesta in secondi. Un sito a cui è stata concessa una richiesta rinnova regolarmente la richiesta. Se booth non riceve alcuna informazione sul rinnovo della richiesta entro il tempo di scadenza definito, la richiesta viene revocata e concessa a un altro sito. Se non si specifica alcun tempo di scadenza, la richiesta scade di default dopo <literal>600</literal> secondi. Il parametro non deve essere impostato a un valore inferiore a 120 secondi.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-timeout">
     <para>
      Parametro opzionale. Definisce la durata del timeout in secondi. Allo scadere di tale periodo, booth invia di nuovo i pacchetti se durante questo periodo non è stata ricevuta alcuna risposta. Il timeout definito deve essere sufficientemente lungo per consentire ai pacchetti di raggiungere altri membri di booth (tutti gli arbitri e i siti).
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-retries">
     <para>
      Parametro opzionale. Definisce quante volte booth riprova a inviare i pacchetti prima di interrompere l'attesa della conferma dagli altri siti. Valori inferiori a <literal>3</literal> non sono validi e impediscono l'avvio di booth.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-renewal">
     <para>
      Parametro opzionale. Imposta il periodo di frequenza di rinnovo della richiesta. Per impostazione predefinita, la richiesta viene rinnovata a metà del periodo di scadenza. Se l'affidabilità della rete viene spesso ridotta per periodi prolungati, si consiglia di eseguire rinnovi più frequenti. Prima di ogni rinnovo, viene eseguito <literal>before-acquire-handler</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-handler">
     <para>
      Parametro opzionale. Supporta uno o più script. Per utilizzare più script, ciascuno script può essere responsabile di controlli diversi, come lo stato del cluster, la connettività con il data center, i sensori di stato dell'ambiente e altro. Memorizzare tutti gli script nella directory <filename>/etc/booth.d/<replaceable>NOME_RICHIESTA</replaceable></filename> e verificare che presentino la corretta proprietà (utente <systemitem class="username">hacluster</systemitem> e gruppo <systemitem class="groupname">haclient</systemitem>). Assegnare il nome della directory come valore al parametro <parameter>before-acquire-handler</parameter>.
     </para>
     <para>
      Gli script in questa directory vengono eseguiti in ordine alfabetico. Tutti gli script vengono richiamati prima che <systemitem class="daemon">boothd</systemitem> tenti di acquisire o rinnovare una richiesta. Per la concessione o il rinnovo della richiesta, <emphasis>tutti</emphasis> gli script devono avere esito positivo. La semantica è la stessa di ogni singolo script: con un codice di uscita diverso da <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> viene abbandonata la richiesta.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-script">
     <para>
      Lo script <filename>/usr/share/booth/service-runnable</filename> è incluso nel prodotto come esempio. Per utilizzarlo, collegarlo alla rispettiva directory della <quote>richiesta</quote>:
     </para>
     <screen><prompt role="root">root # </prompt><command>ln</command> -s /usr/share/booth/service-runnable /etc/booth.d/<replaceable>TICKET_NAME</replaceable></screen>
     <para>
      Si supponga che la directory <filename>/etc/booth.d<replaceable>NOME_RICHIESTA</replaceable></filename> contenga lo script <command>service-runnable</command>. Questo semplice script si basa su <command>crm_simulate</command> e consente di provare se <emphasis>è possibile</emphasis> eseguire una risorsa cluster particolare sul sito del cluster corrente. Ossia, controlla se lo stato del cluster è in grado di eseguire la risorsa (tutte le dipendenze della risorsa sono soddisfatte, la partizione del cluster ha quorum, non sono presenti nodi errati, ecc.). Ad esempio, se un servizio nella catena di dipendenze ha un failcount di <literal>INFINITY</literal> su tutti i nodi disponibili, il servizio non può essere eseguito su tale sito. In tale caso, è inutile richiedere la richiesta.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-rsc">
     <para>
      La risorsa che deve essere provata da <literal>before-acquire-handler</literal> (in questo caso, dallo script <filename>service-runnable</filename>). È necessario fare riferimento alla risorsa protetta dalla richiesta rispettiva. In questo esempio, la risorsa <literal>db-1</literal> è protetta da <literal>ticketA</literal> mentre <literal>db-8</literal> è protetta da <literal>ticketB</literal>. La risorsa di DRBD (<literal>ms_drbd_nfs</literal>) è protetta dalla richiesta <literal>ticket-nfs</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-acquire-after">
     <para>
      Parametro opzionale. Dopo aver perso una richiesta, booth attende ancora per questo intervallo prima di acquisire la richiesta, per consentire al sito che ha perso la richiesta di abbandonare le risorse, arrestandole o delimitando un nodo. Il ritardo tipico è di <literal>60</literal> secondi, ma dipende infine dalle risorse protette e dalla configurazione di delimitazione. Il valore di default è <literal>0</literal>.
     </para>
     <para>
      Se non si è certi del tempo richiesto per l'arresto o l'abbassamento di livello delle risorse o la delimitazione di un nodo (in base alla <literal>policy di perdita</literal>), utilizzare questo parametro per evitare di eseguire le risorse su due siti contemporaneamente.
     </para>
    </callout>
   </calloutlist>
  </example>
  <procedure xml:id="pro-ha-geo-setup-booth-config-edit">
   <title>Modifica manuale del file di configurazione booth</title>
   <step>
    <para>
     Eseguire il login in un nodo del cluster come <systemitem class="username">root</systemitem> o equivalente.
    </para>
   </step>
   <step>
    <para>
     Copiare il file di configurazione booth di esempio <filename>/etc/booth/booth.conf.example</filename> in <filename>/etc/booth/booth.conf</filename>:
    </para>
    <remark>toms 2016-08-09: "cp -p" is needed, see https://bugzilla.suse.com/show_bug.cgi?id=968865#c14</remark>
    <screen><prompt role="root">root # </prompt><command>cp</command> -p /etc/booth/booth.conf.example /etc/booth/booth.conf</screen>
   </step>
   <step>
    <para>
     Modificare <filename>/etc/booth/booth.conf</filename> in base a <xref linkend="ex-ha-booth-conf-default"/>.
    </para>
   </step>
   <step>
    <para>
     Verificare le modifiche e salvare il file.
    </para>
   </step>
   <step>
    <para>
     Su tutti gli arbitri e nodi del cluster, aprire la porta nel firewall configurata per booth. Vedere <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-port"/>.
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-ha-geo-setup-booth-yast">
   <title>Configurazione booth con YaST</title>
   <step>
    <para>
     Eseguire il login in un nodo del cluster come <systemitem class="username">root</systemitem> o equivalente.
    </para>
   </step>
   <step>
    <para>
     Avviare il modulo <guimenu>Geo Cluster</guimenu> YaST.
    </para>
   </step>
   <step>
    <para>
     Scegliere di <guimenu>modificare</guimenu> un file di configurazione booth esistente, oppure fare clic su <guimenu>Aggiungi</guimenu> per creare un nuovo file di configurazione booth:
    </para>
    <substeps performance="required">
     <step xml:id="step-ha-booth-conf-params">
      <para>
       Nella schermata visualizzata, configurare i seguenti parametri:
      </para>
      <itemizedlist>
       <listitem>
        <formalpara>
         <title>File di configurazione</title>
         <para>
          Un nome per il file di configurazione booth. YaST suggerisce <literal>booth</literal> per default. Ciò determina la scrittura della configurazione booth in <filename>/etc/booth/booth.conf</filename>. Modificare questo valore solo se occorre configurare più istanze di booth per diversi Geo cluster, come descritto nella <xref linkend="sec-ha-geo-booth-multi"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Trasporto</title>
         <para>
          Il protocollo di trasporto utilizzato per la comunicazione tra i siti. È supportato solo UDP, ma in futuro saranno disponibili altri livelli di trasporto. Vedere anche <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-transport"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Porta</title>
         <para>
          La porta da utilizzare per la comunicazione tra le istanze di booth in ciascun sito. Vedere anche <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-port"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Arbitro</title>
         <para>
           L'indirizzo IP del computer da utilizzare come arbitro. Vedere anche <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-arbitrator"/>.
         </para>
        </formalpara>
        <para>
         Per specificare un <guimenu>arbitro</guimenu>, fare clic su <guimenu>Aggiungi</guimenu>. Nella finestra di dialogo visualizzata, specificare l'indirizzo IP dell'arbitro e fare clic su <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Sito</title>
         <para>
          L'indirizzo IP utilizzato per <systemitem class="daemon">boothd</systemitem> su un sito. Vedere anche <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-site"/>.
         </para>
        </formalpara>
        <para>
         Per specificare un <guimenu>sito</guimenu> del Geo cluster, fare clic su <guimenu>Aggiungi</guimenu>. Nella finestra di dialogo visualizzata, specificare l'indirizzo IP di un sito e fare clic su <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Richiesta</title>
         <para>
          La richiesta gestita da booth. Vedere anche <xref linkend="ex-ha-booth-conf-default"/>, posizione <xref linkend="co-ha-geo-booth-config-ticket"/>.
         </para>
        </formalpara>
        <para>
         Per specificare una <guimenu>richiesta</guimenu>, fare clic su <guimenu>Aggiungi</guimenu>. Nella finestra di dialogo visualizzata, specificare un nome univoco per la <guimenu>richiesta</guimenu>. Se occorre definire più richieste con gli stessi parametri e valori, salvare la configurazione creando un <quote>modello di richiesta</quote> che specifichi i parametri e i valori di default per tutte le richieste. Per questo, utilizzare <literal>__default__</literal> come nome della <guimenu>richiesta</guimenu>.
        </para>
       </listitem>
       <listitem>
        
        <formalpara>
         <title>Autenticazione</title>
         <para>Per abilitare l'autenticazione per booth, fare clic su <guimenu>Autenticazione</guimenu> e nella finestra di dialogo visualizzata, attivare <guimenu>Abilita autenticazione di sicurezza</guimenu>. Se è già presente una chiave esistente, specificare il percorso e il nome di file in <guimenu>File di autenticazione</guimenu>. Per generare un file della chiave per un nuovo Geo cluster, fare clic su <guimenu>Genera file della chiave di autenticazione</guimenu>. La chiave viene creata e scritta nell'ubicazione specificata in <guimenu>File di autenticazione</guimenu>.</para>
        </formalpara>
        <para>
         Inoltre, è possibile specificare parametri opzionali per la richiesta. Per una panoramica, vedere <xref linkend="ex-ha-booth-conf-default"/>, posizioni da <xref linkend="co-ha-geo-booth-config-expiry"/> a <xref linkend="co-ha-geo-booth-config-acquire-after"/>.
        </para>
        <para>
         Fare clic su <guimenu>OK</guimenu> per confermare le modifiche apportate.
        </para>
       </listitem>
      </itemizedlist>
      <figure xml:id="fig-yast2-ha-geo-booth">
       <title>Esempio di dipendenza della richiesta</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="50%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       Fare clic su <guimenu>OK</guimenu> per chiudere la schermata di configurazione booth corrente. YaST mostra il nome del file di configurazione booth definito.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Prima di chiudere il modulo YaST, passare alla categoria <guimenu>Configurazione firewall</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Per aprire la porta configurata per booth, abilitare <guimenu>Porta aperta nel firewall</guimenu>.
    </para>
    <important>
     <title>impostazione firewall solo per computer locale</title>
     <para>
      L'impostazione del firewall viene applicata solo al computer corrente e apre le porte UDP/TCP per tutte le porte specificate in <filename>/etc/booth/booth.conf</filename> o in altri file di configurazione booth (vedere <xref linkend="sec-ha-geo-booth-multi"/>).
     </para>
     <para>
      Verificare, inoltre, di aprire le porte rispettive su tutti gli altri arbitri e nodi del cluster della configurazione di Geo cluster. Procedere manualmente o sincronizzando i seguenti file con Csync2:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2.d/services/booth</filename>
       </para>
      </listitem>
     </itemizedlist>
    </important>
   </step>
   <step>
    <para>
     Fare clic su <guimenu>Fine</guimenu> per confermare tutte le impostazioni e chiudere il modulo YaST. In base al <replaceable>NOME</replaceable> del <guimenu>file di configurazione</guimenu> specificato in <xref linkend="step-ha-booth-conf-params"/>, la configurazione viene scritta in <filename>/etc/booth/<replaceable>NAME</replaceable>.conf</filename>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-multi">
  <title>Configurazione booth per più tenant</title>

  <para>
    Per configurazioni che comprendono più Geo cluster, è possibile <quote>condividere</quote> lo stesso arbitro (con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Fornendo più file di configurazione booth, è possibile avviare più istanze di booth sullo stesso arbitro, dove ciascuna istanza di booth viene eseguita su una porta diversa. In questo modo, è possibile utilizzare <emphasis>un</emphasis> computer che funga da arbitro per <emphasis>diversi</emphasis> Geo cluster.
  </para>
  <para>
   Si supponga di avere due Geo cluster, uno nell'area EMEA (Europa, Medio Oriente e Africa) e uno nella regione Asia-Pacifico (APAC).
  </para>
  <para>
   Per utilizzare lo stesso arbitro per entrambi i Geo cluster, creare due file di configurazione nella directory <filename>/etc/booth</filename>: <filename>/etc/booth/emea.conf</filename> e <filename>/etc/booth/apac.conf</filename>. Entrambi devono avere minime differenze nei seguenti parametri:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     La porta utilizzata per la comunicazione delle istanze di booth.
    </para>
   </listitem>
   <listitem>
    <para>
     I siti appartenenti ai diversi Geo cluster per cui è utilizzato l'arbitro.
    </para>
   </listitem>
  </itemizedlist>
  <example xml:id="ex-ha-conf-booth-multi-1">
   <title><filename>/etc/booth/apac.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9133 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.2.254 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.1.112 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-apac <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket ="tkt-db-apac-intern" <xref linkend="co-ha-geo-booth-config-ticket"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-apac-intern <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/> 
ticket = "tkt-db-apac-cust" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable db-apac-cust</screen>
  </example>
  <example xml:id="ex-ha-conf-booth-multi-2">
   <title><filename>/etc/booth/emea.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9150 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.201.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-emea <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-crm" <xref linkend="co-ha-geo-booth-config-ticket"/>
     expire = 900 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> sap-crm <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-prod" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable sap-prod</screen>
  </example>
  <calloutlist>
   <callout arearefs="co-ha-geo-booth-config-transport">
    <para>
     Il protocollo di trasporto utilizzato per la comunicazione tra i siti. È supportato solo UDP, ma in futuro saranno disponibili altri livelli di trasporto. Attualmente, è quindi possibile omettere questo parametro.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-port">
    <para>
     La porta da utilizzare per la comunicazione tra le istanze di booth in ciascun sito. I file di configurazione utilizzano porte diverse per consentire l'avvio di più istanze di booth sullo stesso arbitro.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-arbitrator">
    <para>
      L'indirizzo IP del computer da utilizzare come arbitro. Negli esempi precedenti, viene utilizzato lo stesso arbitro per diversi Geo cluster.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-site">
    <para>
     L'indirizzo IP utilizzato per <systemitem class="daemon">boothd</systemitem> su un sito. I siti definiti in entrambi i file di configurazione sono diversi, in quanto appartengono a due diversi Geo cluster.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-auth">
    <para>
     Parametro opzionale. Consente l'autenticazione booth per client e server in base a una chiave condivisa. Questo parametro specifica il percorso del file della chiave. Utilizzare file delle chiavi diversi per differenti tenant.
    </para>
    <itemizedlist>
      <title>Requisiti della chiave</title>
      <listitem>
       <para>La chiave può essere binaria o testuale.</para>
       <para>Se testuale, vengono ignorati i seguenti caratteri: spazio iniziale e finale, nuove linee.</para>
      </listitem>
      <listitem>
       <para>La chiave deve contenere tra 8 e 64 caratteri.</para>
      </listitem>
      <listitem>
        <para>La chiave deve appartenere all'utente <systemitem class="username">hacluster</systemitem> e al gruppo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>Solo il proprietario del file deve poter leggere la chiave.</para>
      </listitem>
     </itemizedlist>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-ticket">
    <para>
     La richiesta gestita da booth. In teoria, è possibile definire gli stessi nomi di richiesta in file di configurazione booth diversi: le richieste non interferiscono perché fanno parte di diversi Geo cluster gestiti da differenti istanze di booth. Tuttavia, (per maggiore praticità) si consiglia di utilizzare nomi di richieste distinti per ogni Geo cluster come illustrato negli esempi precedenti.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-handler">
    <para>
     Parametro opzionale. Se impostato, il comando specificato viene richiamato prima che <systemitem class="daemon">boothd</systemitem> tenti di acquisire o rinnovare una richiesta. Con un codice di uscita diverso da <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> abbandona la richiesta.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-script">
    <para>
     Lo script <filename>service-runnable</filename> è incluso nel prodotto come esempio. Si tratta di un semplice script basato su <command>crm_simulate</command> e consente di provare se <emphasis>è possibile</emphasis> eseguire una risorsa cluster particolare sul sito del cluster corrente. Ossia, controlla se lo stato del cluster è in grado di eseguire la risorsa (tutte le dipendenze della risorsa sono soddisfatte, la partizione del cluster ha quorum, non sono presenti nodi errati, ecc.). Ad esempio, se un servizio nella catena di dipendenze ha un failcount di <literal>INFINITY</literal> su tutti i nodi disponibili, il servizio non può essere eseguito su tale sito. In tale caso, è inutile richiedere la richiesta.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-rsc">
    <para>
     La risorsa che deve essere provata da <literal>before-acquire-handler</literal> (in questo caso, dallo script <filename>service-runnable</filename>). È necessario fare riferimento alla risorsa protetta dalla richiesta rispettiva.
    </para>
   </callout>
  </calloutlist>
  <procedure>
   <title>Utilizzo dello stesso arbitro per diversi Geo cluster</title>
   <step>
    <para>
     Creare diversi file di configurazione booth in <filename>/etc/booth</filename> come mostrato nell'<xref linkend="ex-ha-conf-booth-multi-1"/> e <xref linkend="ex-ha-conf-booth-multi-2"/>. Procedere manualmente o con YaST, come descritto in <xref linkend="pro-ha-geo-setup-booth-yast"/>.
    </para>
   </step>
   <step>
    <para>
     Sull'arbitro, aprire le porte definite in uno dei file di configurazione booth in <filename>/etc/booth</filename>.
    </para>
   </step>
   <step>
    <para>
     Sui nodi appartenenti ai singoli Geo cluster per cui è utilizzato l'arbitro, aprire la porta utilizzata per la rispettiva istanza di booth.
    </para>
   </step>
   <step>
    <para>
     Sincronizzare i rispettivi file di configurazione booth tra tutti gli arbitri e nodi di cluster che utilizzano la stessa configurazione booth. Per informazioni, vedere <xref linkend="sec-ha-geo-booth-sync"/>.
    </para>
   </step>
   <step>
    <para>
     Sull'arbitro, avviare le singole istanze di booth come descritto in <xref linkend="vle-ha-geo-setup-booth-service-arbitrator"/> per configurazioni multi-tenant.
    </para>
   </step>
   <step>
    <para>
     Sui singoli Geo cluster, avviare il servizio booth come descritto in <xref linkend="vle-ha-geo-setup-booth-service-sites"/>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-sync">
  <title>Sincronizzazione della configurazione booth in tutti i siti e arbitri</title>
  <note>
   <title>Utilizzare la stessa configurazione booth in tutti i siti e arbitri</title>
   <para>
    Per il corretto funzionamento di booth, tutti gli arbitri e nodi del cluster in un Geo cluster devono utilizzare la stessa configurazione booth.
   </para>
   <para>
    È possibile utilizzare Csync2 per sincronizzare la configurazione booth. Per ulteriori dettagli, consultare <xref linkend="sec-ha-geo-booth-sync-csync2-setup"/> e <xref linkend="sec-ha-geo-booth-sync-csync2-start"/>.
   </para>
   <para>
    In caso di modifiche alla configurazione booth, verificare di aggiornare di conseguenza i file di configurazione su tutte le parti e riavviare i servizi booth come descritto nella <xref linkend="sec-ha-geo-setup-booth-reconfig"/>.
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-service">
  <title>Abilitazione e avvio dei servizi booth</title>
  <variablelist>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-sites">
    <term>Avvio dei servizi booth sui siti del cluster</term>
    <listitem>
     <para>
      Il servizio booth per ciascun sito del cluster viene gestito dal gruppo risorse di booth configurato nella <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. Per avviare un'istanza del servizio booth per sito, avviare il rispettivo gruppo risorse di booth in ciascun sito del cluster.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-arbitrator">
    <term>Avvio dei servizi booth sugli arbitri</term>

    <listitem>
     <para>
      A partire da SUSE Linux Enterprise 12, gli arbitri booth vengono gestiti con systemd. Il file dell'unità ha il nome <filename>booth@.service</filename>. Il simbolo <literal>@</literal> indica la possibilità di eseguire il servizio con un parametro, in questo caso il nome del file di configurazione.
     </para>
     <para>
      Per <emphasis>abilitare</emphasis> il servizio booth su un arbitro, utilizzare il comando seguente:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable booth@booth</screen>
     <para>
      Dopo aver abilitato il servizio dalla riga di comando, è quindi possibile utilizzare il Gestore dei servizi YaST per gestire il servizio, finché non viene disabilitato. In tale caso, scompare dall'elenco dei servizi in YaST al successivo riavvio di systemd.
     </para>
     <para>
      Tuttavia, il comando per <emphasis>avviare</emphasis> il servizio booth dipende dalla configurazione booth:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Se si utilizza la configurazione di default descritta nella <xref linkend="sec-ha-geo-booth-default"/>, è configurato solo <filename>/etc/booth/booth.conf</filename>. In tale caso, eseguire il login in ciascun arbitro e utilizzare il comando seguente:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@booth</screen>
      </listitem>
      <listitem>
       <para>
        Se si esegue booth in modalità multi-tenant come descritto in <xref linkend="sec-ha-geo-booth-multi"/>, sono stati configurati più file di configurazione booth nella <filename>/etc/booth</filename>. Per avviare i servizi per le singole istanze di booth, utilizzare <command>systemctl start booth@</command> <replaceable>NOME</replaceable>, dove <replaceable>NOME</replaceable> corrisponde al nome del rispettivo file di configurazione <filename>/etc/booth/<replaceable>NOME</replaceable>.conf</filename>.
       </para>
       <para>
        Ad esempio, se sono presenti i file di configurazione booth <filename>/etc/booth/emea.conf</filename> e <filename>/etc/booth/apac.conf</filename>, eseguire il login nell'arbitro ed eseguire i comandi seguenti:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@emea
<prompt role="root">root # </prompt><command>systemctl</command> start booth@apac</screen>
       <para>

       </para>
      </listitem>
     </itemizedlist>
     <para>
      Viene avviato il servizio booth in modalità arbitro che può comunicare con tutti gli altri daemon di booth, ma al contrario dei daemon di booth in esecuzione sui siti del cluster, non è possibile concedervi alcuna richiesta. Gli arbitri booth prendono parte solo alle elezioni. In caso contrario, sono dormienti.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-reconfig">
  <title>Riconfigurazione di booth durante l'esecuzione</title>

  <para>
   Nel caso sia necessario modificare la configurazione booth mentre i servizi booth sono già in esecuzione, procedere come indicato di seguito:
  </para>
  <procedure>
   <step>
    <para>
     Modificare i file di configurazione booth in base alle esigenze.
    </para>
   </step>
   <step>
    <para>
     Sincronizzare i file di configurazione booth aggiornati in tutti gli arbitri e nodi del cluster che fanno parte del Geo cluster. Per informazioni, vedere <xref linkend="sec-ha-geo-sync"/>.
    </para>
   </step>
   <step>

    <para>
     Riavviare i servizi booth su arbitri e siti del cluster come descritto nella <xref linkend="sec-ha-geo-setup-booth-service"/>. Questa operazione non ha alcun effetto sulle richieste già concesse ai siti.
    </para>
   </step>
  </procedure>
 </sect2>
</sect1>
