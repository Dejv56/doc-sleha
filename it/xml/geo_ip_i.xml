<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_ip_i.xml" version="5.0" xml:id="sec-ha-geo-ip-relocation">


 <title>Impostazione della rilocazione IP tramite aggiornamento DNS</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>modifica</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>sì</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Nel caso in cui un sito del Geo cluster non sia disponibile e venga visualizzato un failover della richiesta, in genere è necessario regolare di conseguenza l'indirizzamento di rete (oppure configurare un failover di rete per ogni richiesta). In base al tipo di servizio collegato a una richiesta, esiste una soluzione alternativa per riconfigurare l'instradamento: è possibile utilizzare l'aggiornamento DNS dinamico e modificare invece l'indirizzo IP di un servizio.
 </para>

 <para>
  Per questo scenario è necessario soddisfare i requisiti seguenti:
 </para>

 <itemizedlist>
  <listitem>
   <para>
    Il servizio che deve eseguire il failover è collegato a un nome host.
   </para>
  </listitem>
  <listitem>
   <para>
    Il server DNS deve essere configurato per gli aggiornamenti DNS dinamici. Per informazioni su come procedere con BIND/named, vedere la documentazione <literal>named</literal>, oppure consultare <link xlink:href="http://www.semicomplete.com/articles/dynamic-dns-with-dhcp/"/>. <remark>taroth 2014-11-21: lmb, would you consider the aforementioned link appropriate (WRT to
     our customers and the kind of setup that is needed here)?</remark> Ulteriori informazioni su come configurare DNS, compreso l'aggiornamento dinamico dei dati di zona, sono disponibili nel capitolo <citetitle>Domain Name System</citetitle> della Guida di amministrazione SUSE Linux Enterprise, disponibile da <link xlink:href="http://www.suse.com/documentation/"/>.
   </para>
  </listitem>
  <listitem>
   <para>
    Nell'esempio seguente si suppone che gli aggiornamenti del DNS siano protetti da una chiave condivisa (chiave TSIG) per la zona da aggiornare. È possibile creare la chiave con <command>dnssec-keygen</command>:
   </para>
<screen><prompt role="root">root # </prompt><command>dnssec-keygen</command> -a hmac-md5 -b 128 -n USER geo-update</screen>
   <para>
    Per ulteriori informazioni, vedere la pagina man <command>dnssec-keygen</command> o la Guida di amministrazione SUSE Linux Enterprise, disponibile da <link xlink:href="http://www.suse.com/documentation/"/>. Consultare il capitolo <citetitle>Domain Name System</citetitle>, sezione relativo a <citetitle>transazioni protette</citetitle>.
   </para>
  </listitem>
 </itemizedlist>

 <para>
  <xref linkend="ex-ha-geo-dyn-dns-rsc-config"/> illustra come utilizzare l'agente della risorsa <systemitem>ocf:heartbeat:dnsupdate</systemitem> per gestire il comando <command>nsupdate</command>. <remark>taroth 2014-11-21: lmb, is the following correct? it
   is mentioned in the description of fate#316112, however, your example in c#9 mentions focuses on
   IPv4 only...</remark> L'agente della risorsa supporta IPv4 e IPv6.
 </para>

 <example xml:id="ex-ha-geo-dyn-dns-rsc-config">
  <title>Configurazione della risorsa per l'aggiornamento DNS dinamico</title>
<screen><prompt role="custom">crm(live)configure# </prompt><command>primitive</command> dns-update-ip ocf:heartbeat:dnsupdate params \
  hostname="www.domain.com"<co xml:id="co-dyn-dns-hostname"/> ip="192.168.3.4"<co xml:id="co-dyn-dns-ip"/>\
  keyfile="<replaceable>/etc/whereever/Kgeo-update*</replaceable>.key"<co xml:id="co-dyn-dns-key"/>\
  server="192.168.1.1"<co xml:id="co-dyn-dns-srv"/> serverport="53"<co xml:id="co-dyn-dns-srv-port"/></screen>
  <calloutlist>
   <callout arearefs="co-dyn-dns-hostname">
    <para>
     Nome host collegato al servizio che deve eseguire il failover insieme alla richiesta. L'indirizzo IP di questo host deve essere aggiornato tramite DNS dinamico.
    </para>
   </callout>
   <callout arearefs="co-dyn-dns-ip">
    <para>
     Indirizzo IP del server che ospita il servizio da migrare. <remark>taroth 2014-11-21:
     lmb, this description taken from fate c#9 is IMHO a bit misleading as it seems to imply that
     this param is about the *current* IP address. However, from the description in
     /usr/lib/ocf/resource.d/heartbeat/dnsupdate, I think this needs to be the IP address that
     will be used for the hostname *after* failover - is that correct?</remark> L'indirizzo IP specificato qui può anche essere sotto controllo del cluster. Il failover locale non viene gestito, ma si assicura che le parti esterne verranno indirizzate al sito corretto dopo un failover della richiesta.
    </para>
   </callout>
   <callout arearefs="co-dyn-dns-key">
    <para>
     Percorso del file della chiave pubblica generato con <command>dnssec-keygen</command>.
    </para>
   </callout>
   <callout arearefs="co-dyn-dns-srv">
    <para>
     Indirizzo IP del server DNS a cui inviare gli aggiornamenti. Se non viene fornito alcun server, viene considerato il server master della zona corretta.
    </para>
   </callout>
   <callout arearefs="co-dyn-dns-srv-port">
    <para>
     Porta da utilizzare per la comunicazione con il server DNS. Questa opzione ha effetto solo se si specifica un server DNS.
    </para>
   </callout>
  </calloutlist>
  <para>
   Con la precedente configurazione della risorsa, l'agente della risorsa si occupa della rimozione del sito del Geo cluster in errore dal record DNS e della modifica dell'IP per un servizio tramite un aggiornamento DNS dinamico.
  </para>
 </example>
</sect1>
