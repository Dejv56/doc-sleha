<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec-ha-geo-manage">
 <title>Gestione dei Geo cluster</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>modifica</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>sì</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Prima che booth sia in grado di gestire una determinata richiesta nel Geo cluster, occorre inizialmente concederla manualmente a un sito.
 </para>

 <sect2 xml:id="sec-ha-geo-manage-cli">
  <title>Dalla riga di comando</title>
  <para>
   Utilizzare lo strumento della riga di comando <command>booth client</command> per concedere, elencare o revocare le richieste come descritto in <xref linkend="vl-ha-booth-client-cmds"/>. È possibile eseguire i comandi <command>booth client</command> su qualsiasi computer nel cluster, non solo quelli in cui <systemitem class="daemon">boothd</systemitem> è in esecuzione. I comandi <command>booth client</command> cercano di trovare il cluster <quote>locale</quote> controllando il file di configurazione booth e gli indirizzi IP definiti localmente. Se non si specifica un sito a cui il client booth deve connettersi (mediante l'opzione <option>-s</option>), il booth si collegherà sempre al sito locale.
  </para>
  <note>
   <title>modifiche alla sintassi</title>
   <para>
    La sintassi dei comandi del client booth è stata semplificata a partire da <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11. Ad esempio, è possibile omettere la parola chiave <literal>client</literal> per le operazioni <option>list</option>, <option>grant</option> o <option>revoke</option>: <command>booth list</command>. Anche l'opzione <option>-t</option> può essere omessa quando si specifica una richiesta.
   </para>
   <para>
    La sintassi precedente è ancora supportata. Per informazioni dettagliate, vedere la sezione relativa a <literal>sinopsi</literal> nella pagina man booth. Gli esempi in questo manuale utilizzano, tuttavia, la sintassi semplificata.
   </para>
  </note>

  <variablelist xml:id="vl-ha-booth-client-cmds">
   <title>Panoramica dei comandi <command>booth client</command></title>
   <varlistentry>
    <term>Elenco di tutte le richieste</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      Se non si specifica un determinato sito con <option>-s</option>, le informazioni sulle richieste vengono richieste dall'istanza di booth locale.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Concessione di una richiesta a un sito</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      In questo caso, <literal>ticketA</literal> verrà concessa al sito <literal>192.168.201.151</literal>. Se si tralascia l'opzione <option>-s</option>, booth si collegherà automaticamente al sito corrente (quello in cui viene eseguito il booth client) e richiederà l'operazione <command>grant</command>.
     </para>
     <para>
      Prima di concedere una richiesta, il comando esegue un controllo di sicurezza. Se la stessa richiesta è già concessa a un altro sito, viene visualizzato un avvertimento e chiesto di revocare prima la richiesta dal sito corrente.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Revoca di una richiesta da un sito</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      Booth controlla per quale sito è attualmente concessa la richiesta e richiede l'operazione <command>revoke</command> per <literal>ticketA</literal>. L'operazione di revoca viene eseguita immediatamente.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Le operazioni <command>grant</command> e, in determinate circostanze, <command>revoke</command> non restituiscono immediatamente il risultato di un'operazione definita. Il client attende il risultato fino al valore di <varname>timeout</varname> della richiesta prima di interrompere l'attesa; a meno che non sia stata utilizzata l'opzione <option>-w</option>, in tale caso il client attende indefinitamente. Trovare lo stato esatto nei file di log o con il comando <command>crm_ticket -L</command>.
  </para>
  <warning>
   <title><command>crm_ticket</command> e <command>crm site ticket</command></title>
   <para>
    Nel caso in cui per qualsiasi motivo il servizio booth non sia in esecuzione, è inoltre possibile gestire manualmente le richieste con <command>crm_ticket</command> o <command>crm site ticket</command>. Entrambi i comandi sono disponibili solo sui nodi del cluster. In caso di intervento, utilizzarli con cautela in quanto <emphasis>non possono</emphasis> verificare se la stessa richiesta sia già stata concessa altrove. Per ulteriori informazioni, consultare le pagine man.
   </para>
   <para>
    Finché booth è attivo e in esecuzione, utilizzare solo <command>booth client</command> per l'intervento manuale.
   </para>
  </warning>
  <para>
   Dopo aver concesso inizialmente una richiesta a un sito, il meccanismo di booth prende in carico la richiesta e la gestisce automaticamente. Se occorre disattivare il sito che detiene una richiesta, quest'ultima viene revocata automaticamente dopo il periodo di scadenza e concessa a un altro sito. Le risorse che dipendono da tale richiesta eseguono il failover sul nuovo sito che detiene la richiesta. I nodi che hanno eseguito le risorse prima verranno trattati in base alla <literal>policy di perdita</literal> impostata con il vincolo.
  </para>

  <procedure xml:id="pro-ha-geo-manage-tickets">
   <title>Gestione manuale delle richieste</title>
   <para>
    Supponendo di voler spostare manualmente <literal>ticket-nfs</literal> dal sito <literal>amsterdam</literal> (con IP virtuale <literal>192.168.201.151</literal>) al sito <literal>berlin</literal> (con IP virtuale <literal>192.168.202.151</literal>), procedere come indicato di seguito:
   </para>
   <step>
    <para>
     Impostare <literal>ticket-nfs</literal> su standby con il seguente comando:
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     Attendere che le risorse che dipendono da <literal>ticket-nfs</literal> vengano arrestate o abbassate di livello correttamente.
    </para>
   </step>
   <step>
    <para>
     Revocare <literal>ticket-nfs</literal> dal sito <literal>amsterdam</literal> con:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     Dopo aver revocato la richiesta dal sito originale, concederla al sito <literal>berlin</literal> con:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
