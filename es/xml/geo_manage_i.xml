<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec-ha-geo-manage">
 <title>Gestión de los clústeres geográficos</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editar</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>sí</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Antes de que booth pueda gestionar un ticket determinado en el clúster geográfico, debe otorgarlo a un sitio manualmente.
 </para>

 <sect2 xml:id="sec-ha-geo-manage-cli">
  <title>Con la línea de comandos</title>
  <para>
   Utilice la herramienta de línea de comandos <command>cliente de booth</command> para otorgar, mostrar o revocar tickets, como se describe en <xref linkend="vl-ha-booth-client-cmds"/>. Los comandos del <command>cliente de booth</command> se pueden ejecutar en cualquier equipo del clúster, no solo en los que se ejecuta <systemitem class="daemon">boothd</systemitem>. Los comandos del <command>cliente de booth</command> intentan encontrar el clúster <quote>local</quote> en el archivo de configuración de booth y en las direcciones IP definidas localmente. Si no especifica un sitio con el que deba conectarse el cliente de booth (con la opción <option>-s</option>), se conectará siempre al sitio local.
  </para>
  <note>
   <title>cambios de sintaxis</title>
   <para>
    Se ha simplificado la sintaxis de los comandos del cliente de booth desde la versión <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11. Por ejemplo, la palabra clave <literal>client</literal> se puede omitir para las operaciones <option>list</option>, <option>grant</option> o <option>revoke</option>: <command>booth list</command>. Además, la opción <option>-t</option> se puede omitir cuando se especifica un ticket.
   </para>
   <para>
    Aún se admite la sintaxis anterior. Para obtener información detallada, consulte la sección <literal>Resumen</literal> en la página man de booth. Sin embargo, en los ejemplos en este manual se utiliza la sintaxis simplificada.
   </para>
  </note>

  <variablelist xml:id="vl-ha-booth-client-cmds">
   <title>Descripción general de los comandos del <command>cliente de booth</command></title>
   <varlistentry>
    <term>Listado de todos los tickets</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      Si no se especifica un sitio determinado con <option>-s</option>, se solicita la información de los tickets a la instancia de booth local.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Concesión de un ticket a un sitio</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      En este caso, <literal>ticketA</literal> se otorga al sitio <literal>192.168.201.151</literal>. Si omite la opción <option>-s</option>, booth se conecta automáticamente al sitio actual (el sitio en el que se ejecuta el cliente de booth) y pide la operación <command>grant</command>.
     </para>
     <para>
      Antes de otorgar un ticket, el comando ejecuta una comprobación. Si el mismo ticket ya se ha otorgado a otro sitio, se le advertirá al respecto y se le pedirá que revoque primero el ticket del sitio actual.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Revocación de ticket a un sitio</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      Booth comprueba qué sitio tiene actualmente otorgado el ticket y pide la operación <command>revoke</command> para <literal>ticketA</literal>. La operación de revocación se ejecuta de inmediato.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Las operaciones <command>grant</command> y, en determinadas circunstancias, <command>revoke</command> pueden tardar un poco en devolver el resultado definitivo de la operación. El cliente espera el resultado el <varname>tiempo límite</varname> indicado para el ticket antes de abandonar la operación, a no ser que se haya utilizado la opción <option>-w</option>, en cuyo caso espera indefinidamente. Para comprobar el estado exacto, consulte los archivos de registro o utilice el comando <command>crm_ticket -L</command>.
  </para>
  <warning>
   <title><command>crm_ticket</command> y <command>crm site ticket</command></title>
   <para>
    En caso de que el servicio booth no se esté ejecutando por cualquier motivo, también puede gestionar los tickets de forma manual con los comandos <command>crm_ticket</command> o <command>crm site ticket</command>. Ambos comandos solo están disponibles en los nodos de clúster. En caso de intervención, utilícelos con mucho cuidado, ya que <emphasis>no es posible</emphasis> comprobar si el mismo ticket ya se ha otorgado en otro lugar. Para obtener más información, consulte las páginas man.
   </para>
   <para>
    Siempre que booth esté activo y en ejecución, utilice solo el <command>cliente de booth</command> para intervenir manualmente.
   </para>
  </warning>
  <para>
   Después de otorgar inicialmente un ticket a un sitio, el mecanismo booth tomará la iniciativa y gestionará de forma automática el ticket. Si el sitio que contiene un ticket está fuera de servicio, el ticket se revoca automáticamente después del tiempo de caducidad y se otorga a otro sitio. En los recursos que dependen del ticket se producirá una operación de failover al nuevo sitio donde se encuentre el ticket. Los nodos que hayan ejecutado antes los recursos se tratarán de acuerdo con la directiva <literal>loss-policy</literal> que haya establecido en la restricción.
  </para>

  <procedure xml:id="pro-ha-geo-manage-tickets">
   <title>Gestión manual de tickets</title>
   <para>
    Por ejemplo, si desea trasladar manualmente <literal>ticket-nfs</literal> del sitio <literal>amsterdam</literal> (con la IP virtual <literal>192.168.201.151</literal>) al sitio <literal>berlin</literal> (con la IP virtual <literal>192.168.202.151</literal>), haga lo siguiente:
   </para>
   <step>
    <para>
     Pase <literal>ticket-nfs</literal> a modo de reserva con el siguiente comando:
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     Espere a que los recursos que dependen de <literal>ticket-nfs</literal> se detengan o bajen de nivel sin problemas.
    </para>
   </step>
   <step>
    <para>
     Revoque <literal>ticket-nfs</literal> del sitio <literal>amsterdam</literal> con:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     Después de que el ticket se haya revocado en su sitio original, otórguelo al sitio <literal>berlin</literal> con:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
