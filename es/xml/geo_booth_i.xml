<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_booth_i.xml" version="5.0" xml:id="sec-ha-geo-booth">
 <title>Configuración de los servicios de booth</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editar</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>sí</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  La configuración de booth por defecto es <filename>/etc/booth/booth.conf</filename>. Este archivo debe ser el mismo en todos los sitios del clúster geográfico, incluidos los árbitros. Para mantener la configuración de booth sincronizada en todos los sitios y árbitros, utilice Csync2, como se describe en la <xref linkend="sec-ha-geo-booth-sync"/>.
 </para>

 <note xml:id="note-ha-geo-booth-ownership">
  <title>propiedad de <filename class="directory">/etc/booth</filename> y los archivos</title>
  <para>
   El directorio <filename class="directory">/etc/booth</filename> y todos los archivos incluidos en él deben pertenecer al usuario <systemitem class="username">hacluster</systemitem> y al grupo <systemitem class="groupname">haclient</systemitem>. Siempre que copie un archivo nuevo desde este directorio, utilice la opción <option>-p</option> para que el comando <command>cp</command> preserve la propiedad. Como alternativa, cuando cree un archivo nuevo, defina el usuario y el grupo después mediante <command>chown</command> <option>hacluster:haclient<replaceable>ARCHIVO</replaceable></option>.
  </para>
 </note>

 <para>
   En las instalaciones que incluyen varios clústeres geográficos, es posible <quote>compartir</quote> el mismo árbitro (a partir de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Al proporcionar varios archivos de configuración de booth, es posible iniciar varias instancias de booth en el mismo árbitro, ejecutando cada instancia en un puerto distinto. De este modo, puede utilizar <emphasis>un único</emphasis> equipo como árbitro para <emphasis>distintos</emphasis> clústeres geográficos. Para obtener información sobre cómo configurar booth para varios clústeres geográficos, consulte la <xref linkend="sec-ha-geo-booth-multi"/>.
 </para>
 
 
 <para>Para impedir que partes malintencionadas puedan interrumpir el servicio de booth, es posible configurar que el servicio de autenticación se comunique con booth basándose en una clave compartida. Para obtener más información, consulte <xref linkend="co-ha-geo-booth-config-auth"/> en el <xref linkend="ex-ha-booth-conf-default"/>. Todos los hosts que se comunican con varios servidores de booth necesitan esta clave. Por lo tanto, asegúrese de incluir el archivo de clave en la configuración de Csync2 o sincronícelo manualmente a todas las partes.</para>

 <sect2 xml:id="sec-ha-geo-booth-default">
  <title>Configuración por defecto de booth</title>
  <para>
   Para configurar todos los parámetros necesarios para booth, edite manualmente los archivos de configuración de booth o mediante el módulo <guimenu>GeoCluster</guimenu> de YaST. Para acceder al módulo de YaST, inícielo en la línea de comandos con <command>yast2 geo-cluster</command> (o inicie YaST y seleccione <menuchoice> <guimenu>Alta disponibilidad</guimenu> <guimenu>GeoCluster</guimenu></menuchoice>).
  </para>
  <example xml:id="ex-ha-booth-conf-default">
   <title>Archivo de configuración de booth</title>

<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <co xml:id="co-ha-geo-booth-config-transport"/>
port = 9929 <co xml:id="co-ha-geo-booth-config-port"/>
arbitrator = 147.2.207.14 <co xml:id="co-ha-geo-booth-config-arbitrator"/>
site =  192.168.201.151 <co xml:id="co-ha-geo-booth-config-site"/>
site =  192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey <co xml:id="co-ha-geo-booth-config-auth"/>
ticket = "ticket-nfs" <co xml:id="co-ha-geo-booth-config-ticket"/>
     expire = 600 <co xml:id="co-ha-geo-booth-config-expiry"/>
     timeout = 10 <co xml:id="co-ha-geo-booth-config-timeout"/>
     retries = 5 <co xml:id="co-ha-geo-booth-config-retries"/>
     renewal-freq = 30 <co xml:id="co-ha-geo-booth-config-renewal"/>
     before-acquire-handler<co xml:id="co-ha-geo-booth-config-handler"/> = /etc/booth/ticket-nfs<co xml:id="co-ha-geo-booth-config-script"/> ms_drbd_nfs<co xml:id="co-ha-geo-booth-config-rsc"/>
     acquire-after = 60 <co xml:id="co-ha-geo-booth-config-acquire-after"/>
ticket = "ticketA" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-A<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-1 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
ticket = "ticketB" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co-ha-geo-booth-config-expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co-ha-geo-booth-config-timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co-ha-geo-booth-config-retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co-ha-geo-booth-config-renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-B<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-8 <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co-ha-geo-booth-config-acquire-after" xrefstyle="select:label nopage"/>
    </screen>
   <calloutlist>
    <callout arearefs="co-ha-geo-booth-config-transport">
     <para>
      El protocolo de transporte utilizado para la comunicación entre los sitios. Solo se admite UDP, pero se incluirán otras capas de transporte en el futuro. Actualmente, este parámetro se puede omitir.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-port">
     <para>
      El puerto que se debe usar para la comunicación entre las instancias de booth de cada sitio. Si no usa el puerto por defecto (<literal>9929</literal>), elija uno que no se utilice ya en otros servicios. Asegúrese de abrir el puerto en el cortafuegos de los nodos y los árbitros. Los clientes de booth utilizan TCP para comunicarse con <systemitem class="daemon">boothd</systemitem>. El mecanismo booth siempre se asocia a los puertos UDP y TCP y realiza la escucha en ellos.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-arbitrator">
     <para>
       La dirección IP del equipo que se debe usar como árbitro. Añada una entrada para cada árbitro que utilice en la configuración del clúster geográfico.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-site">
     <para>
      La dirección IP que se utiliza para <systemitem class="daemon">boothd</systemitem> en un sitio. Añada una entrada para cada sitio que utilice en la configuración del clúster geográfico. Asegúrese de insertar las direcciones IP virtuales correctas (<systemitem>IPaddr2</systemitem>) para cada sitio; de lo contrario, el mecanismo booth no funcionará correctamente. Para obtener información sobre cómo configurar la dirección IP virtual para booth, consulte el <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. booth funciona con direcciones IPv4 e IPv6.

     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-auth">
     <para>
      Parámetro opcional. Permite la autenticación de booth para los clientes y servidores basándose en una clave compartida. Este parámetro especifica la vía al archivo de clave. 
     </para>
     <itemizedlist>
      <title>Requisitos de la clave</title>
      <listitem>
       <para>La clave puede ser binaria o de texto.</para>
       <para>Si es de texto, los siguientes caracteres se omiten: los espacios en blanco inicial y final y los saltos de línea.</para>
      </listitem>
      <listitem>
       <para>La clave debe tener entre 8 y 64 caracteres.</para>
      </listitem>
      <listitem>
        <para>La clave debe pertenecer al usuario <systemitem class="username">hacluster</systemitem> y al grupo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>Solo el propietario de la clave debe ser capaz de leerla.</para>
      </listitem>
     </itemizedlist>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-ticket">
     <para>
      El ticket que se va a gestionar en booth. Para cada ticket, añada una entrada <literal>ticket</literal>. En este ejemplo, se usará el ticket <literal>ticket-nfs</literal> para el failover de NFS y DRBD. Consulte la <xref linkend="sec-ha-geo-drbd"/> para obtener más información.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-expiry">
     <para>
      Parámetro opcional. Define el tiempo de caducidad del ticket en segundos. Un sitio al que se la ha otorgado un ticket lo renovará con regularidad. Si booth no recibe información acerca de la renovación del ticket en el tiempo de caducidad definido, el ticket se revoca y se otorga a otro sitio. Si no se especifica ningún tiempo de caducidad, el ticket caduca por defecto después de <literal>600</literal> segundos. No se debe establecer un valor inferior a 120 segundos para este parámetro.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-timeout">
     <para>
      Parámetro opcional. Define un periodo de tiempo límite en segundos. Después de ese tiempo, booth vuelve a enviar los paquetes si no ha recibido una respuesta. El tiempo límite definido debe ser lo suficientemente largo para permitir que los paquetes lleguen a otros miembros de booth (todos los árbitros y sitios).
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-retries">
     <para>
      Parámetro opcional. Define el número de veces que booth intenta enviar los paquetes antes de que deje de esperar una confirmación de otros sitios. No se admiten valores inferiores a <literal>3</literal>, que impedirían que booth se iniciara.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-renewal">
     <para>
      Parámetro opcional. Establece la frecuencia de renovación del ticket. La renovación del ticket se produce por defecto a la mitad del tiempo límite. Si la fiabilidad de la red se reduce a menudo por largo periodos de tiempo, es aconsejable renovar con más frecuencia. Antes de cada renovación, se ejecuta <literal>before-acquire-handler</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-handler">
     <para>
      Parámetro opcional. Admite uno o varios guiones. Si desea utilizar más de un guion, cada uno de ellos puede ser responsable de comprobaciones diferentes, como el estado del clúster, la conectividad del centro de datos, los sensores de estado del entorno, etc. Almacene todos los guiones en el directorio <filename>/etc/booth.d/<replaceable>TICKET_NAME</replaceable></filename> y asegúrese de que tienen la propiedad correcta (usuario <systemitem class="username">hacluster</systemitem> y grupo <systemitem class="groupname">haclient</systemitem>). Asigne el nombre de directorio como valor para el parámetro <parameter>before-acquire-handler</parameter>.
     </para>
     <para>
      Los guiones de este directorio se ejecutan en orden alfabético. Todos los guiones se llaman antes de que <systemitem class="daemon">boothd</systemitem> intente adquirir o renovar un ticket. Para que el informe se otorgue o se renueve, <emphasis>todos</emphasis> los guiones se deben completar correctamente. La semántica es la misma que para un único guion: si el código de salida no es <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> cede el ticket.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-script">
     <para>
      El guion <filename>/usr/share/booth/service-runnable</filename> se incluye en el producto como ejemplo. Para usarlo, enlácelo en el directorio <quote>ticket</quote> correspondiente:
     </para>
     <screen><prompt role="root">root # </prompt><command>ln</command> -s /usr/share/booth/service-runnable /etc/booth.d/<replaceable>TICKET_NAME</replaceable></screen>
     <para>
      Supongamos que el directorio <filename>/etc/booth.d/<replaceable>TICKET_NAME</replaceable></filename> contiene el guion <command>service-runnable</command>. Este guion sencillo se basa en <command>crm_simulate</command>. Se puede utilizar para probar si un recurso de clúster determinado <emphasis>puede</emphasis> ejecutarse en el sitio actual del clúster. Esto significa que comprueba si el clúster está en un estado lo suficientemente bueno para ejecutar el recurso (se cumplen todas las dependencias del recurso, la partición de clúster tiene quórum, no hay nodos contaminados, etc.). Por ejemplo, si un servicio de la cadena de dependencias tiene como número de fallos el valor <literal>INFINITY</literal> en todos los nodos disponibles, el servicio no se puede ejecutar en dicho sitio. En tal caso, reclamar el ticket no sirve de nada.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-rsc">
     <para>
      El recurso que se va a probar mediante <literal>before-acquire-handler</literal> (en este caso, por el guion <filename>service-runnable</filename>). Debe hacer referencia al recurso que está protegido por el ticket respectivo. En este ejemplo, el recurso<literal>db-1</literal> está protegido por <literal>ticketA</literal>, mientras que <literal>db-8</literal> está protegido por <literal>ticketB</literal>. El recurso para DRBD (<literal>ms_drbd_nfs</literal>) está protegido por el ticket <literal>ticket-nfs</literal>.
     </para>
    </callout>
    <callout arearefs="co-ha-geo-booth-config-acquire-after">
     <para>
      Parámetro opcional. Cuando se pierda un ticket, booth esperará este tiempo de más antes de adquirir el ticket. Esto sirve para permitir que el sitio que ha perdido el ticket ceda los recursos, ya sea deteniéndolos o delimitándolos. Un retraso típico puede ser de <literal>60</literal> segundos, pero en última instancia depende de los recursos protegidos y la configuración de delimitación. El valor por defecto es <literal>0</literal>.
     </para>
     <para>
      Si no tiene claro cuánto tiempo tardarán en detenerse o bajar de nivel los recursos o en aislarse un nodo (depende de <literal>loss-policy</literal>), utilice este parámetro para impedir que los recursos se ejecuten en dos sitios al mismo tiempo.
     </para>
    </callout>
   </calloutlist>
  </example>
  <procedure xml:id="pro-ha-geo-setup-booth-config-edit">
   <title>Edición manual del archivo de configuración de booth</title>
   <step>
    <para>
     Entre en un nodo de clúster como usuario <systemitem class="username">root</systemitem> o equivalente.
    </para>
   </step>
   <step>
    <para>
     Copie el archivo de configuración de booth de ejemplo <filename>/etc/booth/booth.conf.example</filename> para <filename>/etc/booth/booth.conf</filename>:
    </para>
    <remark>toms 2016-08-09: "cp -p" is needed, see https://bugzilla.suse.com/show_bug.cgi?id=968865#c14</remark>
    <screen><prompt role="root">root # </prompt><command>cp</command> -p /etc/booth/booth.conf.example /etc/booth/booth.conf</screen>
   </step>
   <step>
    <para>
     Edite <filename>/etc/booth/booth.conf</filename> de acuerdo con el <xref linkend="ex-ha-booth-conf-default"/>.
    </para>
   </step>
   <step>
    <para>
     Compruebe los cambios y guarde el archivo.
    </para>
   </step>
   <step>
    <para>
     En todos los nodos del clúster y árbitros, abra el puerto en el cortafuegos que se haya configurado para booth. Consulte el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-port"/>.
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-ha-geo-setup-booth-yast">
   <title>Configuración de booth con YaST</title>
   <step>
    <para>
     Entre en un nodo de clúster como usuario <systemitem class="username">root</systemitem> o equivalente.
    </para>
   </step>
   <step>
    <para>
     Inicie el módulo <guimenu>GeoCluster</guimenu> de YaST.
    </para>
   </step>
   <step>
    <para>
     Seleccione la opción <guimenu>Editar</guimenu> para modificar un archivo de configuración de booth existente o <guimenu>Añadir</guimenu> para crear un nuevo archivo de configuración de booth:
    </para>
    <substeps performance="required">
     <step xml:id="step-ha-booth-conf-params">
      <para>
       En la pantalla que aparece, configure los siguientes parámetros:
      </para>
      <itemizedlist>
       <listitem>
        <formalpara>
         <title>Archivo de configuración</title>
         <para>
          Un nombre para el archivo de configuración de booth. YaST sugiere <literal>booth</literal> por defecto. Esto hace que la configuración de booth se escriba en<filename>/etc/booth/booth.conf</filename>. Cambie este valor solo si necesita configurar varias instancias de booth para diferentes clústeres geográficos, tal y como se describe en la <xref linkend="sec-ha-geo-booth-multi"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Transporte</title>
         <para>
          El protocolo de transporte utilizado para la comunicación entre los sitios. Solo se admite UDP, pero se incluirán otras capas de transporte en el futuro. Consulte también el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-transport"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Puerto</title>
         <para>
          El puerto que se debe usar para la comunicación entre las instancias de booth de cada sitio. Consulte también el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-port"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Árbitro</title>
         <para>
           La dirección IP del equipo que se debe usar como árbitro. Consulte también el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-arbitrator"/>.
         </para>
        </formalpara>
        <para>
         Para especificar un <guimenu>árbitro</guimenu>, haga clic en <guimenu>Añadir.</guimenu> En el recuadro de diálogo que se abre, introduzca la dirección IP de su árbitro y haga clic en <guimenu>Aceptar.</guimenu>
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Sitio</title>
         <para>
          La dirección IP que se utiliza para <systemitem class="daemon">boothd</systemitem> en un sitio. Consulte también el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-site"/>.
         </para>
        </formalpara>
        <para>
         Para especificar un <guimenu>sitio</guimenu> del clúster geográfico, haga clic en <guimenu>Añadir.</guimenu> En el recuadro de diálogo que se abre, introduzca la dirección IP de un sitio y haga clic en <guimenu>Aceptar.</guimenu>
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Ticket</title>
         <para>
          El ticket que se va a gestionar en booth. Consulte también el <xref linkend="ex-ha-booth-conf-default"/>, posición <xref linkend="co-ha-geo-booth-config-ticket"/>.
         </para>
        </formalpara>
        <para>
         Para especificar un <guimenu>ticket,</guimenu> haga clic en <guimenu>Añadir.</guimenu> En el recuadro de diálogo que se abre, introduzca un nombre de <guimenu>ticket</guimenu> exclusivo. Si necesita definir varios tickets con los mismos parámetros y valores, puede ahorrarse el esfuerzo de configuración creando una <quote>plantilla de ticket</quote> que especifique los parámetros y valores por defecto para todos los tickets. Para hacerlo, utilice <literal>__default__</literal> como nombre de <guimenu>ticket</guimenu>.
        </para>
       </listitem>
       <listitem>
        
        <formalpara>
         <title>Autenticación</title>
         <para>Para habilitar la autenticación para booth, haga clic en <guimenu>Autenticación</guimenu> y, en el recuadro de diálogo que se abre, active <guimenu>Habilitar autenticación de seguridad.</guimenu> Si ya tiene una clave, especifique la vía y el nombre del archivo en <guimenu>Archivo de autenticación.</guimenu> Para generar un archivo de clave para un clúster geográfico nuevo, haga clic en <guimenu>Generar archivo de clave de autenticación.</guimenu> La clave se crea y se escribe en la ubicación especificada en <guimenu>Archivo de autenticación.</guimenu></para>
        </formalpara>
        <para>
         Asimismo, puede especificar parámetros opcionales para el ticket. Para obtener una descripción general, consulte el <xref linkend="ex-ha-booth-conf-default"/>, posiciones <xref linkend="co-ha-geo-booth-config-expiry"/> a <xref linkend="co-ha-geo-booth-config-acquire-after"/>.
        </para>
        <para>
         Haga clic en <guimenu>Aceptar</guimenu> para confirmar los cambios.
        </para>
       </listitem>
      </itemizedlist>
      <figure xml:id="fig-yast2-ha-geo-booth">
       <title>Dependencia de ticket de ejemplo</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="50%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       Haga clic en <guimenu>Aceptar</guimenu> para cerrar la pantalla de configuración de booth actual. YaST muestra el nombre del archivo de configuración de booth que haya definido.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Antes de cerrar el módulo de YaST, cambie a la categoría <guimenu>Configuración del cortafuegos.</guimenu>
    </para>
   </step>
   <step>
    <para>
     Para abrir el puerto que ha configurado para booth, habilite <guimenu>Abrir puerto en el cortafuegos.</guimenu>
    </para>
    <important>
     <title>configuración del cortafuegos solo para el equipo local</title>
     <para>
      La configuración del cortafuegos solo se aplica al equipo actual. Abre los puertos TCP/UDP de todos los puertos que se han especificado en <filename>/etc/booth/booth.conf</filename> o en cualquier otro archivo de configuración de booth (consulte la <xref linkend="sec-ha-geo-booth-multi"/>).
     </para>
     <para>
      Asegúrese de abrir también los puertos correspondientes en todos los demás nodos del clúster y árbitros de la configuración del clúster geográfico. Puede hacerlo manualmente o sincronizando los archivos siguientes con Csync2:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2.d/services/booth</filename>
       </para>
      </listitem>
     </itemizedlist>
    </important>
   </step>
   <step>
    <para>
     Haga clic en <guimenu>Finalizar</guimenu> para confirmar todos los ajustes y cerrar el módulo de YaST. Dependiendo del <replaceable>NOMBRE</replaceable> del <guimenu>archivo de configuración</guimenu> especificado en el <xref linkend="step-ha-booth-conf-params"/>, la configuración se escribe en <filename>/etc/booth/<replaceable>NOMBRE</replaceable>.conf</filename>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-multi">
  <title>Configuración de booth para varios inquilinos</title>

  <para>
    En las instalaciones que incluyen varios clústeres geográficos, es posible <quote>compartir</quote> el mismo árbitro (a partir de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Al proporcionar varios archivos de configuración de booth, es posible iniciar varias instancias de booth en el mismo árbitro, ejecutando cada instancia en un puerto distinto. De este modo, puede utilizar <emphasis>un único</emphasis> equipo como árbitro para <emphasis>distintos</emphasis> clústeres geográficos.
  </para>
  <para>
   Supongamos que dispone de dos clústeres geográficos, uno en la zona EMEA (Europa, Oriente medio y África) y otro en la región Asia-Pacífico (APAC).
  </para>
  <para>
   Para utilizar el mismo árbitro para ambos clústeres geográficos, cree dos archivos de configuración en el directorio <filename>/etc/booth</filename>: <filename>/etc/booth/emea.conf</filename> y <filename>/etc/booth/apac.conf</filename>. Como mínimo, debe haber diferencias entre ambos en los siguientes parámetros:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     El puerto utilizado para la comunicación de las instancias de booth.
    </para>
   </listitem>
   <listitem>
    <para>
     Los sitios que pertenecen a los distintos clústeres geográficos para los que se usa el árbitro.
    </para>
   </listitem>
  </itemizedlist>
  <example xml:id="ex-ha-conf-booth-multi-1">
   <title><filename>/etc/booth/apac.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9133 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.2.254 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.1.112 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-apac <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket ="tkt-db-apac-intern" <xref linkend="co-ha-geo-booth-config-ticket"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> db-apac-intern <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/> 
ticket = "tkt-db-apac-cust" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable db-apac-cust</screen>
  </example>
  <example xml:id="ex-ha-conf-booth-multi-2">
   <title><filename>/etc/booth/emea.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co-ha-geo-booth-config-transport" xrefstyle="select:label nopage"/>
port = 9150 <xref linkend="co-ha-geo-booth-config-port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co-ha-geo-booth-config-arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.201.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
site = 192.168.202.151 <xref linkend="co-ha-geo-booth-config-site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-emea <xref linkend="co-ha-geo-booth-config-auth" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-crm" <xref linkend="co-ha-geo-booth-config-ticket"/>
     expire = 900 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co-ha-geo-booth-config-handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co-ha-geo-booth-config-script" xrefstyle="select:label nopage"/> sap-crm <xref linkend="co-ha-geo-booth-config-rsc" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-prod" <xref linkend="co-ha-geo-booth-config-ticket" xrefstyle="select:label nopage"/>
     expire = 600 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable sap-prod</screen>
  </example>
  <calloutlist>
   <callout arearefs="co-ha-geo-booth-config-transport">
    <para>
     El protocolo de transporte utilizado para la comunicación entre los sitios. Solo se admite UDP, pero se incluirán otras capas de transporte en el futuro. Actualmente, este parámetro se puede omitir.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-port">
    <para>
     El puerto que se debe usar para la comunicación entre las instancias de booth de cada sitio. Los archivos de configuración utilizan puertos diferentes para iniciar varias instancias de booth en el mismo árbitro.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-arbitrator">
    <para>
      La dirección IP del equipo que se debe usar como árbitro. En los ejemplos anteriores, se utiliza el mismo árbitro para diferentes clústeres geográficos.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-site">
    <para>
     La dirección IP que se utiliza para <systemitem class="daemon">boothd</systemitem> en un sitio. Los sitios definidos en ambos archivos de configuración de booth son distintos, ya que pertenecen a dos clústeres geográficos diferentes.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-auth">
    <para>
     Parámetro opcional. Permite la autenticación de booth para los clientes y servidores basándose en una clave compartida. Este parámetro especifica la vía al archivo de clave. Utilice archivos de clave diferentes para distintos inquilinos.
    </para>
    <itemizedlist>
      <title>Requisitos de la clave</title>
      <listitem>
       <para>La clave puede ser binaria o de texto.</para>
       <para>Si es de texto, los siguientes caracteres se omiten: los espacios en blanco inicial y final y los saltos de línea.</para>
      </listitem>
      <listitem>
       <para>La clave debe tener entre 8 y 64 caracteres.</para>
      </listitem>
      <listitem>
        <para>La clave debe pertenecer al usuario <systemitem class="username">hacluster</systemitem> y al grupo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>Solo el propietario de la clave debe ser capaz de leerla.</para>
      </listitem>
     </itemizedlist>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-ticket">
    <para>
     El ticket que se va a gestionar en booth. En teoría, es posible definir el mismo nombre de ticket en distintos archivos de configuración de booth: los tickets no interferirán entre sí porque forman parte de clústeres geográficos distintos que están gestionados por distintas instancias de booth. Sin embargo, (para facilitar el resumen) es recomendable utilizar nombres de ticket distintos para cada clúster geográfico, tal y como se muestra en los ejemplos anteriores.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-handler">
    <para>
     Parámetro opcional. Si se define, el comando especificado se llamará antes de que <systemitem class="daemon">boothd</systemitem> intente adquirir o renovar un ticket. Si el código de salida es distinto a <literal>0</literal>, <systemitem class="daemon">boothd</systemitem> cede el ticket.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-script">
    <para>
     El guion <filename>service-runnable</filename> al que se hace referencia aquí se incluye en el producto como ejemplo. Se trata de un guion sencillo basado en <command>crm_simulate</command>. Se puede utilizar para probar si un recurso de clúster determinado <emphasis>puede</emphasis> ejecutarse en el sitio actual del clúster. Esto significa que comprueba si el clúster está en un estado lo suficientemente bueno para ejecutar el recurso (se cumplen todas las dependencias del recurso, la partición de clúster tiene quórum, no hay nodos contaminados, etc.). Por ejemplo, si un servicio de la cadena de dependencias tiene como número de fallos el valor <literal>INFINITY</literal> en todos los nodos disponibles, el servicio no se puede ejecutar en dicho sitio. En tal caso, reclamar el ticket no sirve de nada.
    </para>
   </callout>
   <callout arearefs="co-ha-geo-booth-config-rsc">
    <para>
     El recurso que se va a probar mediante <literal>before-acquire-handler</literal> (en este caso, por el guion <filename>service-runnable</filename>). Debe hacer referencia al recurso que está protegido por el ticket respectivo.
    </para>
   </callout>
  </calloutlist>
  <procedure>
   <title>Uso del mismo árbitro para distintos clústeres geográficos</title>
   <step>
    <para>
     Cree archivos de configuración de booth distintos en <filename>/etc/booth</filename>, como se muestra en el <xref linkend="ex-ha-conf-booth-multi-1"/> y el <xref linkend="ex-ha-conf-booth-multi-2"/>. Hágalo manualmente o mediante YaST, como se describe en el <xref linkend="pro-ha-geo-setup-booth-yast"/>.
    </para>
   </step>
   <step>
    <para>
     En el árbitro, abra los puertos definidos en alguno de los archivos de configuración de booth de <filename>/etc/booth</filename>.
    </para>
   </step>
   <step>
    <para>
     En los nodos que pertenecen a los clústeres geográficos individuales para los que se utiliza el árbitro, abra el puerto que se utiliza para la instancia de booth respectiva.
    </para>
   </step>
   <step>
    <para>
     Sincronice los archivos de configuración de booth correspondientes en todos los nodos del clúster y en los árbitros que utilicen la misma configuración de booth. Para obtener información, consulte la <xref linkend="sec-ha-geo-booth-sync"/>.
    </para>
   </step>
   <step>
    <para>
     En el árbitro, inicie las instancias individuales de booth, como se describe en <xref linkend="vle-ha-geo-setup-booth-service-arbitrator"/> para las configuraciones de varios inquilinos.
    </para>
   </step>
   <step>
    <para>
     En los clústeres geográficos individuales, inicie el servicio de booth como se describe en <xref linkend="vle-ha-geo-setup-booth-service-sites"/>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-geo-booth-sync">
  <title>Sincronización de la configuración de booth en todos los sitios y árbitros</title>
  <note>
   <title>uso de la misma configuración de booth en todos los sitios y árbitros</title>
   <para>
    Para que booth funcione correctamente, todos los nodos del clúster y los árbitros de un clúster geográfico deben utilizar la misma configuración de booth.
   </para>
   <para>
    Puede utilizar Csync2 para sincronizar la configuración de booth. Para obtener más detalles, consulte la <xref linkend="sec-ha-geo-booth-sync-csync2-setup"/> y la <xref linkend="sec-ha-geo-booth-sync-csync2-start"/>.
   </para>
   <para>
    En caso de que cambie alguna configuración de booth, asegúrese de actualizar en consecuencia los archivos de configuración en todas las partes y reinicie los servicios de booth, tal y como se describe en la <xref linkend="sec-ha-geo-setup-booth-reconfig"/>.
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-service">
  <title>Habilitación e inicio de los servicios de booth</title>
  <variablelist>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-sites">
    <term>Inicio de los servicios de booth en sitios de clúster</term>
    <listitem>
     <para>
      El servicio de booth para cada sitio de clúster se gestiona mediante el grupo de recursos de booth configurado en el <xref linkend="pro-ha-geo-setup-rsc-boothd"/>. Para iniciar una instancia del servicio de booth en cada sitio, inicie el grupo de recursos de booth correspondiente en cada sitio de clúster.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-geo-setup-booth-service-arbitrator">
    <term>Inicio de los servicios de booth en árbitros</term>

    <listitem>
     <para>
      A partir de SUSE Linux Enterprise 12, los árbitros de booth se gestionan con systemd. El archivo de unidad se denomina <filename>booth@.service</filename>. El signo <literal>@</literal> indica la posibilidad de ejecutar el servicio con un parámetro, que en este caso es el nombre del archivo de configuración.
     </para>
     <para>
      Para <emphasis>habilitar</emphasis> el servicio de booth en un árbitro, utilice el comando siguiente:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable booth@booth</screen>
     <para>
      Después de habilitar el servicio en la línea de comandos, se puede usar Gestor de servicios de YaST para gestionar el servicio, siempre que no esté inhabilitado. En tal caso, desaparecerá de la lista de servicios de YaST la próxima vez que se reinicie systemd.
     </para>
     <para>
      Sin embargo, el comando para <emphasis>iniciar</emphasis> el servicio de booth depende de la configuración de booth:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Si utiliza la instalación por defecto descrita en la <xref linkend="sec-ha-geo-booth-default"/>, solo se configura <filename>/etc/booth/booth.conf</filename>. En tal caso, entre en cada árbitro y utilice el comando siguiente:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@booth</screen>
      </listitem>
      <listitem>
       <para>
        Si se ejecuta booth en el modo de varios inquilinos descrito en la <xref linkend="sec-ha-geo-booth-multi"/>, habrá configurado varios archivos de configuración de booth en <filename>/etc/booth</filename>. Para iniciar los servicios de las instancias individuales de booth, utilice <command>systemctl start booth@</command> <replaceable>NOMBRE</replaceable>, donde <replaceable>NOMBRE</replaceable> representa el nombre del archivo de configuración <filename>/etc/booth/<replaceable>NOMBRE</replaceable>.conf</filename> correspondiente.
       </para>
       <para>
        Por ejemplo, si dispone de los archivos de configuración de booth <filename>/etc/booth/emea.conf</filename> y <filename>/etc/booth/apac.conf</filename>, entre en su árbitro y ejecute los comandos siguientes:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@emea
<prompt role="root">root # </prompt><command>systemctl</command> start booth@apac</screen>
       <para>

       </para>
      </listitem>
     </itemizedlist>
     <para>
      De esta forma, se inicia el servicio de booth en modo de árbitro. Se puede comunicar con todos los demás daemons de booth, pero a diferencia de los daemons de booth que se ejecutan en los sitios de clúster, no se le puede otorgar un ticket. Los árbitros de booth solo actúan en las elecciones. En otras situaciones, están en desuso.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-ha-geo-setup-booth-reconfig">
  <title>Reconfiguración de booth durante la ejecución</title>

  <para>
   En caso de que necesite cambiar la configuración de booth mientras los servicios de booth están en ejecución, haga lo siguiente:
  </para>
  <procedure>
   <step>
    <para>
     Ajuste los archivos de configuración de booth como desee.
    </para>
   </step>
   <step>
    <para>
     Sincronice los archivos de configuración de booth actualizados con todos los nodos de clúster y los árbitros que formen parte de su clúster geográfico. Para obtener información, consulte la <xref linkend="sec-ha-geo-sync"/>.
    </para>
   </step>
   <step>

    <para>
     Reinicie los servicios de booth en los árbitros y los sitios de clúster, como se describe en la <xref linkend="sec-ha-geo-setup-booth-service"/>. Esto no afecta de ninguna forma a los tickets que ya se han otorgado a los sitios.
    </para>
   </step>
  </procedure>
 </sect2>
</sect1>
