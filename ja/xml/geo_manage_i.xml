<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec-ha-geo-manage">
 <title>Geoクラスタの管理</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編集</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  ブースがGeoクラスタ内の特定のチケットを管理するためには、まずチケットを手動でサイトに付与する必要があります。
 </para>

 <sect2 xml:id="sec-ha-geo-manage-cli">
  <title>コマンドラインから</title>
  <para>
   <xref linkend="vl-ha-booth-client-cmds"/>で説明するように、<command>booth client</command>コマンドラインツールを使用して、チケットの付与、一覧表示、または取り消しを行います。<command>booth client</command>コマンドは、<systemitem class="daemon">boothd</systemitem>が実行されているマシン上だけでなく、クラスタ内の任意のマシン上で実行できます。<command>booth client</command>コマンドは、ブース設定ファイルとローカルに指定されたIPアドレスを参照することで、<quote>ローカル</quote>クラスタを見つけようとします。ブースクライアントが接続する必要のあるサイトを指定していない場合は(<option>-s</option>オプションを使用)、ブースクライアントは常にローカルサイトに接続します。
  </para>
  <note>
   <title>構文の変更</title>
   <para>
    ブースクライアントコマンドの構文は、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11から簡易化されました。たとえば、<literal>client</literal>キーワードを<option>list</option>、<option>grant</option>、または<option>revoke</option>操作について省略できます(<command>booth list</command>)。また、チケットを指定する際に<option>-t</option>オプションを省略できます。
   </para>
   <para>
    以前の構文も引き続き使用できます。詳細については、ブースのマニュアルページの<literal>Synopsis</literal>のセクションを参照してください。 ただし、このマニュアルに記載されている例では簡易化された構文を使用しています。
   </para>
  </note>

  <variablelist xml:id="vl-ha-booth-client-cmds">
   <title><command>booth client</command>コマンドの概要</title>
   <varlistentry>
    <term>すべてのチケットのリスト表示</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      <option>-s</option>オプションを使用して特定のサイトを指定していない場合は、チケットに関する情報がローカルブースインスタンスに対して要求されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>チケットをサイトに付与する</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      この場合、<literal>ticketA</literal>がサイト<literal>192.168.201.151</literal>に付与されます。<option>-s</option>オプションを省略した場合は、ブースは自動的に現在のサイト(ブースクライアントを実行しているサイト)に接続して、<command>grant</command>操作を要求します。
     </para>
     <para>
      チケットを付与する前に、このコマンドではサニティチェックが実行されます。同じチケットが別のサイトにすでに付与されている場合、そのことに関する警告が表示され、まず現在のサイトからチケットを取り消すように促されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>サイトからチケットを取り消す</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      ブースは当該チケットが現在付与されているサイトを確認して、<literal>ticketA</literal>に対する<command>revoke</command>操作を要求します。取り消し操作は即座に実行されます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   <command>grant</command>操作および<command>revoke</command>操作(特定の状況下の場合)は、明確な操作の結果を返すまでにしばらく時間がかかることがあります。クライアントは、通常はチケットの <varname>timeout</varname> 値に達するまで結果を待ちますが、<option>-w</option>オプションが指定されている場合は、クライアントは無期限に結果を待ち続けます。正確なステータスを確認するには、ログファイルを参照するか、<command>crm_ticket -L</command>コマンドを使用します。
  </para>
  <warning>
   <title><command>crm_ticket</command>および<command>crm site ticket</command></title>
   <para>
    ブースサービスが何らかの理由で実行されていない場合、<command>crm_ticket</command>または<command>crm site ticket</command>でチケットを手動で管理することもできます。両コマンドはクラスタノードでのみ使用できます。これらのコマンドは、同じチケットが他のサイトにすでに付与されているかどうかを確認「できない」ため、手動で管理する場合は、十分に注意してこれらのコマンドを使用してください。<emphasis/>詳細については、マニュアルページを参照してください。
   </para>
   <para>
    ブースが起動し、実行されている限り、手動の管理には<command>booth client</command>のみを使用します。
   </para>
  </warning>
  <para>
   最初にサイトにチケットを付与した後、ブースメカニズムがチケットを自動的に引き継いで管理します。チケットを持つサイトがサービス外である場合、チケットは有効期限後に自動的に取り消され、他のサイトに付与されます。そのチケットに依存するリソースは、チケットを持つ新しいサイトにフェールオーバーします。前にリソースを実行していたノードは、制約で設定した<literal>loss-policy</literal>によって処理されます。
  </para>

  <procedure xml:id="pro-ha-geo-manage-tickets">
   <title>チケットの手動管理</title>
   <para>
    <literal>ticket-nfs</literal>をサイト<literal>amsterdam</literal> (仮想IPアドレス<literal>192.168.201.151</literal>)からサイト<literal>berlin</literal> (仮想IPアドレス<literal>192.168.202.151</literal>)に手動で移動する場合は、以下の手順を実行します。
   </para>
   <step>
    <para>
     次のコマンドを使用して、<literal>ticket-nfs</literal>をスタンバイに設定します。
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     <literal>ticket-nfs</literal>に依存するリソースがすべて停止するか、完全に降格するまで待機します。
    </para>
   </step>
   <step>
    <para>
     次のコマンドを使用して、<literal>ticket-nfs</literal>をサイト<literal>amsterdam</literal>から取り消します。
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     チケットが元のサイトから取り消されたら、次のコマンドを使用して、このチケットをサイト<literal>berlin</literal>に付与します。
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
