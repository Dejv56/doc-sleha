<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_upgrade_i.xml" version="5.0" xml:id="sec-ha-geo-upgrade">
 <title>最新の製品バージョンへのアップグレード</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編集</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para> クラスタのアップグレード方法に関する一般的な指示については、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP2</phrase></phrase>の『<citetitle>Administration Guide</citetitle>』を参照してください。 <link xlink:href="http://www.suse.com/documentation/"/>で入手できます。「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」という章では、アップグレードプロセスを開始する前に行うべき準備についても説明しています。 </para>

 <table xml:id="table-ha-geo-upgrade-oview">
  <title>SLE HAおよびSLE HA Geoでサポートされるアップグレードパス</title>
  <tgroup cols="3">
   <colspec colnum="1" colname="1" colwidth="25*"/>
   <colspec colnum="2" colname="2" colwidth="22*"/>
   <colspec colnum="3" colname="3" colwidth="53*"/>
   <thead>
    <row>
     <entry>
      <para> アップグレード元とアップグレード先 </para>
     </entry>
     <entry>
      <para> アップグレードパス </para>
     </entry>
     <entry>
      <para> 詳細情報の参照先 </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para> SLE HA 11 SP3からSLE HA (Geo) 12 </para>
     </entry>
     <entry>
      <para> オフラインマイグレーション </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基本システム: 『<citetitle>SUSE Linux Enterprise Server 12導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
        </para>
       </listitem>
       <listitem>
        <para> SLE HA: <citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle>の『Administration Guide』、「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」の章の「<citetitle>Offline Migration</citetitle>」の節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo: <xref linkend="sec-ha-geo-upgrade-offline" xrefstyle="select:title nopage"/>
        </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> SLE HA (Geo) 11 SP4からSLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> オフラインマイグレーション </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基本システム: 『<citetitle>SUSE Linux Enterprise Server 12 SP1導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
        </para>
       </listitem>
       <listitem>
        <para> SLE HA: <citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle>の『Administration Guide』、「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」の章の「<citetitle>Offline Migration</citetitle>」の節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo: <xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> SLE HA (Geo) 12からSLE HA (Geo) 12 SP1 </para>
     </entry>
     <entry>
      <para> ローリングアップグレード </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基本システム: 『<citetitle>SUSE Linux Enterprise Server 12 SP1導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
        </para>
       </listitem>
       <listitem>
        <para> SLE HA: <citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle>の『Administration Guide』、「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」の章の「<citetitle>Rolling Upgrade</citetitle>」の節
        </para>
       </listitem>
       <listitem>
         <para> SLE HA Geo: <xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
        </listitem>
       </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para> SLE HA (Geo) 12 SP1からSLE HA (Geo) 12 SP2</para>
     </entry>
     <entry>
      <para> ローリングアップグレード </para>
     </entry>
     <entry>
      <itemizedlist>
       <listitem>
        <para> 基本システム: 『<citetitle>SUSE Linux Enterprise Server 12 SP2導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
        </para>
       </listitem>
       <listitem>
        <para> SLE HA: 『<citetitle>Administration Guide for <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle>』、「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」の章の「<citetitle>Rolling Upgrade</citetitle>」の節
        </para>
       </listitem>
       <listitem>
        <para> SLE HA Geo: <xref linkend="sec-ha-geo-upgrade-arbitrators" xrefstyle="select:title nopage"/> </para>
       </listitem>
       <listitem>
        <para>DRBD 8 to DRBD 9: 『<citetitle>Administration Guide for <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP2</citetitle>』、「<citetitle>DRBD</citetitle>」の章の「<citetitle>Migrating from DRBD 8 to DRBD 9</citetitle>」の節
         </para>
       </listitem>
      </itemizedlist>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <sect2 xml:id="sec-ha-geo-upgrade-offline">
  <title>オフラインマイグレーション</title>
  <para> この項は次のシナリオに適用されます。 </para>
  <itemizedlist>
   <listitem>
    <para> SLE HA Geo 11 SP3からSLE HA Geo 12へのアップグレード</para>
   </listitem>
  </itemizedlist>
  <para> <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11から11 SP3のブースバージョン(v0.1)は、Paxosアルゴリズムに基づいていました。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 SP4および<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12/12 SPxのブースバージョン(v0.2)は大まかにraftに基づいているため、v0.1を実行しているものとは互換性がありません。したがって、旧ブースバージョンを実行しているシステムから新しいブースバージョンを実行しているシステムへのローリングアップグレードは不可能です。代わりに、<xref linkend="pro-ha-geo-upgrade-offline"/>で説明されているように、すべてのクラスタノードをオフラインにしてから、クラスタ全体を移行する必要があります。</para>
  <para> 新しいマルチテナンシー機能が原因で、新しいアービトレータ初期化スクリプトはPaxos v0.1アービトレータのステータスを停止することもテストすることもできません。v0.2へのアップグレード時には、アービトレータは実行されている場合は停止されます。OCFリソースエージェント<literal>ocf:pacemaker:booth-site</literal>は、ブースv0.1サイトデーモンを停止および監視できます。 </para>

  <procedure xml:id="pro-ha-geo-upgrade-offline">
   <title>クラスタ全体のオフラインマイグレーション</title>
   <step>
    <para>クラスタノードのアップグレードについては、『<citetitle>Administration Guide for <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1</citetitle>』で、「<citetitle>Upgrading Your Cluster and Updating Software Packages</citetitle>」の章の「<citetitle>Offline Migration</citetitle>」の節の指示に従ってください。 </para>
   </step>
   <step>
    <para> クラスタサイト外でアービトレータを使用する場合は、次のようにします。 </para>
    <substeps performance="required">
      <step>
      <para> 各アービトレータを希望のSUSE Linux Enterprise Serverバージョンにアップグレードします。個々のアップグレードプロセスの詳細を確認するには、<xref linkend="table-ha-geo-upgrade-oview"/>を参照してください。 </para>
     </step>
     <step>
      <para> Geoクラスタリング拡張を追加して、パッケージをインストールします(<xref linkend="sec-ha-geo-inst-arbitrators"/>を参照)。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> ブースの構文とコンセンサスアルゴリズムが変更されたため、最新の要件に適合するようにブース設定ファイルを更新する必要があります。以前は、セミコロン(<literal>;</literal>)を区切り文字として使用して、チケット名の後ろに有効期限と重みを付加することで、これらを希望に応じて指定可能でした。新しい構文では、すべてのチケットオプションについて別個のトークンが用意されています。詳細については、<xref linkend="sec-ha-geo-booth"/>を参照してください。デフォルトと異なる有効期限や重みを指定しなかった場合に、マルチテナンシー機能を使用しない場合は、以前の<filename>/etc/booth/booth.conf</filename>を引き続き使用できます。 </para>
   </step>
   <step>
    <para> すべてのクラスタサイトとアービトレータの間で更新後のブース設定ファイルを同期させます。 </para>
   </step>
   <step>
    <para> クラスタサイトとアービトレータ上でブースサービスを開始します(<xref linkend="sec-ha-geo-setup-booth-service"/>を参照)。 </para>
   </step>
  </procedure>
 </sect2>
 <sect2 xml:id="sec-ha-geo-upgrade-arbitrators">
  <title>アービトレータのアップグレード</title>
  <para> この項は次のシナリオに適用されます。 </para>
  <itemizedlist>
   <listitem>
    <para> SLE HA Geo 11 SP4からSLE HA Geo 12 SP1へのアップグレード </para>
   </listitem>
   <listitem>
    <para> SLE HA Geo 12からSLE HA Geo 12 SP1へのアップグレード</para>
   </listitem>
   <listitem>
    <para> SLE HA Geo 12 SP1からSLE HA Geo 12 SP2へのアップグレード</para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-ha-geo-upgrade-arbitrators">
   <title>クラスタ外のアービトレータのアップグレード</title>
   <para> クラスタサイト外でアービトレータを使用する場合は、各アービトレータについて以下の手順を実行します。</para>
  <step>
    <para>目的のターゲットバージョンのSUSE Linux Enterprise Serverへのアップグレードを実行します。個々のアップグレードプロセスの詳細を確認するには、<xref linkend="table-ha-geo-upgrade-oview"/>を参照してください。</para>
   </step>
   <step>
    <para> Geoクラスタリング拡張を追加して、パッケージをインストールします(<xref linkend="sec-ha-geo-inst-arbitrators"/>を参照)。 </para>
   </step>
  </procedure>
 </sect2>
</sect1>
