<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec-ha-geo-manage">
 <title>Verwalten von GeoClustern</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>Bearbeiten</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>Ja</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Bevor ein bestimmtes Ticket im GeoCluster von booth verwaltet werden kann, müssen Sie es einmal manuell einer Site gewähren.
 </para>

 <sect2 xml:id="sec-ha-geo-manage-cli">
  <title>Über die Kommandozeile</title>
  <para>
   Verwenden Sie das Kommandozeilenwerkzeug <command>booth client</command>, um Tickets zu gewähren, aufzulisten oder zurückzuziehen, wie in <xref linkend="vl-ha-booth-client-cmds"/> beschrieben. Die <command>booth client</command>-Kommandos können auf jedem Rechner im Cluster ausgeführt werden, nicht nur auf denen, auf denen <systemitem class="daemon">boothd</systemitem> ausgeführt wird. Die <command>booth client</command>-Kommandos versuchen, den <quote>lokalen</quote> Cluster zu finden, und berücksichtigen dabei die booth-Konfigurationsdatei und die lokal definierten IP-Adressen. Wenn Sie keine Site angeben, mit dem der booth-Client eine Verbindung herstellen soll, (mit der Option <option>-s</option>) wird immer eine Verbindung mit der lokalen Site hergestellt.
  </para>
  <note>
   <title>Syntaxänderungen</title>
   <para>
    Die Syntax von „booth client“-Kommandos wurde seit <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 vereinfacht. So kann beispielsweise das Schlüsselwort <literal>client</literal> für <option>list</option>-, <option>grant</option>- oder <option>revoke</option>-Vorgänge ausgelassen werden: <command>booth list</command>. Außerdem kann die Option <option>-t</option> beim Angeben eines Tickets ausgelassen werden.
   </para>
   <para>
    Die frühere Syntax wird auch weiterhin unterstützt. Ausführliche Informationen finden Sie im Abschnitt <literal>Synopsis</literal> (Übersicht) auf der man-Seite zu booth. In den Beispielen in diesem Handbuch wird jedoch die vereinfachte Syntax verwendet.
   </para>
  </note>

  <variablelist xml:id="vl-ha-booth-client-cmds">
   <title>Überblick über <command>booth client</command>-Kommandos</title>
   <varlistentry>
    <term>Alle Tickets auflisten</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      Wenn Sie nicht mit <option>-s</option> eine bestimmte Site angeben, werden die Informationen zu den Tickets von der lokalen booth-Instanz angefordert.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Einer Site ein Ticket gewähren</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      In diesem Fall wird <literal>ticketA</literal> der Site <literal>192.168.201.151</literal> gewährt. Wenn Sie die Option <option>-s</option> auslassen, stellt booth automatisch eine Verbindung mit der aktuellen Site her (der Site, auf der Sie den booth-Client ausführen) und fordert den <command>grant</command>-Vorgang an.
     </para>
     <para>
      Vor dem Gewähren eines Tickets wird mit diesem Kommando eine Sicherheitsprüfung ausgeführt. Wenn dasselbe Ticket bereits einer anderen Site gewährt wurde, erhalten Sie eine entsprechende Warnung und werden aufgefordert, das Ticket zunächst von der aktuellen Site zurückzuziehen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Ein Ticket von einer Site zurückziehen</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      booth prüft, welcher Site das Ticket bereits gewährt wurde, und fordert den <command>revoke</command>-Vorgang für <literal>ticketA</literal> an. Der „revoke“-Vorgang wird sofort ausgeführt.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Beim <command>grant</command>-Vorgang und unter bestimmten Umständen auch beim <command>revoke</command>-Vorgang kann es eine Weile dauern, bis ein definitives Ergebnis des Vorgangs zurückgegeben wird. Der Client wartet auf das Ergebnis, bis der Wert des Tickets für die  <varname>Zeitüberschreitung</varname> erreicht ist, und stellt das Warten dann ein – es sei denn, die Option <option>-w</option> wurde verwendet, was bedeutet, dass der Client auf unbestimmte Zeit wartet. Den genauen Status finden Sie in den Protokolldateien. Alternativ Sie können ihn mit dem Kommando <command>crm_ticket -L</command> abrufen.
  </para>
  <warning>
   <title><command>crm_ticket</command> und <command>crm site ticket</command></title>
   <para>
    Wenn der booth-Service aus irgendeinem Grund nicht ausgeführt wird, können Sie Tickets auch manuell mit <command>crm_ticket</command> oder <command>crm site ticket</command> verwalten. Beide Kommandos sind nur auf Cluster-Knoten verfügbar. Sollte ein solcher manueller Eingriff erforderlich sein, verwenden Sie die Kommandos mit großer Vorsicht, denn damit <emphasis>kann nicht</emphasis> überprüft werden, ob dasselbe Ticket bereits an anderer Stelle gewährt wurde. Weitere Informationen finden Sie auf den man-Seiten.
   </para>
   <para>
    Solange booth betriebsbereit ist, verwenden Sie für manuelle Eingriffe ausschließlich <command>booth client</command>.
   </para>
  </warning>
  <para>
   Nachdem Sie ein Ticket einmal einer Site gewährt haben, übernimmt der booth-Mechanismus und verwaltet das Ticket automatisch. Fällt die Site, die ein Ticket besitzt, aus, wird das Ticket nach Verstreichen der Ablaufzeit automatisch zurückgezogen und einer anderen Site gewährt. Die von diesem Ticket abhängigen Ressourcen gehen per Failover auf die neue Site über, die das Ticket nun besitzt. Die Knoten, auf denen die Ressourcen zuvor ausgeführt wurden, werden entsprechend der Verlustrichtlinie (<literal>loss-policy</literal>) behandelt, die Sie in der Einschränkung festgelegt haben.
  </para>

  <procedure xml:id="pro-ha-geo-manage-tickets">
   <title>Tickets manuell verwalten</title>
   <para>
    Angenommen, Sie möchten <literal>ticket-nfs</literal> manuell von der Site <literal>amsterdam</literal> (mit der virtuellen IP-Adresse <literal>192.168.201.151</literal>) auf die Site <literal>berlin</literal> (mit der virtuellen IP-Adresse <literal>192.168.202.151</literal>) verschieben. Führen Sie dazu die folgenden Schritte aus:
   </para>
   <step>
    <para>
     Setzen Sie <literal>ticket-nfs</literal> mit dem folgenden Kommando auf Standby:
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     Warten Sie, bis alle von <literal>ticket-nfs</literal> abhängigen Ressourcen gestoppt oder fehlerfrei herabgestuft worden sind.
    </para>
   </step>
   <step>
    <para>
     Ziehen Sie <literal>ticket-nfs</literal> mit folgendem Kommando von der Site <literal>amsterdam</literal> zurück:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     Nachdem das Ticket von der ursprünglichen Site zurückgezogen wurde, gewähren Sie es mit folgendem Kommando der Site <literal>berlin</literal>:
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
